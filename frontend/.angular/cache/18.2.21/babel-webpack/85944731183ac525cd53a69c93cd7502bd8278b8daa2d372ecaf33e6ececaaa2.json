{"ast":null,"code":"import { catchError, interval, map, of, startWith, switchMap } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./core/services/auth.service\";\nimport * as i2 from \"./core/services/renta.service\";\nimport * as i3 from \"./core/services/notificacion.service\";\nimport * as i4 from \"@angular/router\";\nimport * as i5 from \"@angular/common\";\nfunction AppComponent_ng_container_12_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\", 17);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r2.badgeCount);\n  }\n}\nfunction AppComponent_ng_container_12_a_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"a\", 18);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_container_12_a_10_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r2 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r2.cerrarMobileMenu());\n    });\n    i0.ɵɵtext(1, \"Admin\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction AppComponent_ng_container_12_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"a\", 11);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_container_12_Template_a_click_1_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.cerrarMobileMenu());\n    });\n    i0.ɵɵtext(2, \"Explorar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"a\", 12);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_container_12_Template_a_click_3_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.cerrarMobileMenu());\n    });\n    i0.ɵɵtext(4, \" Bandeja \");\n    i0.ɵɵtemplate(5, AppComponent_ng_container_12_span_5_Template, 2, 1, \"span\", 13);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"a\", 14);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_container_12_Template_a_click_6_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.cerrarMobileMenu());\n    });\n    i0.ɵɵtext(7, \"Publicar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"a\", 15);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_container_12_Template_a_click_8_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.cerrarMobileMenu());\n    });\n    i0.ɵɵtext(9, \"Perfil\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, AppComponent_ng_container_12_a_10_Template, 2, 0, \"a\", 16);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r2 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.badgeCount > 0);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r2.esAdmin);\n  }\n}\nfunction AppComponent_ng_template_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"a\", 19);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_template_13_Template_a_click_0_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.cerrarMobileMenu());\n    });\n    i0.ɵɵtext(1, \"Entrar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(2, \"a\", 20);\n    i0.ɵɵlistener(\"click\", function AppComponent_ng_template_13_Template_a_click_2_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r2 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r2.cerrarMobileMenu());\n    });\n    i0.ɵɵtext(3, \"Crear cuenta\");\n    i0.ɵɵelementEnd();\n  }\n}\nexport let AppComponent = /*#__PURE__*/(() => {\n  class AppComponent {\n    constructor(authService, rentaService, notificacionService, router) {\n      this.authService = authService;\n      this.rentaService = rentaService;\n      this.notificacionService = notificacionService;\n      this.router = router;\n      this.badgeCount = 0;\n      this.mobileMenuOpen = false;\n      this.sub = null;\n    }\n    ngOnInit() {\n      this.iniciarBadgePolling();\n    }\n    ngOnDestroy() {\n      if (this.sub) {\n        this.sub.unsubscribe();\n        this.sub = null;\n      }\n    }\n    iniciarBadgePolling() {\n      if (this.sub) return;\n      this.sub = interval(15000).pipe(startWith(0), switchMap(() => {\n        if (!this.authService.isAuthenticated()) {\n          return of(0);\n        }\n        return this.rentaService.chatUnreadTotal().pipe(catchError(() => this.notificacionService.listar().pipe(map(d => Number(d?.unread_count ?? 0) || 0), catchError(() => of(0)))));\n      })).subscribe({\n        next: total => {\n          this.badgeCount = Number(total ?? 0) || 0;\n        },\n        error: () => {\n          // silencioso\n        }\n      });\n    }\n    irInbox() {\n      this.router.navigate(['/inbox']);\n    }\n    irAExplorar() {\n      this.router.navigate(['/explorar']);\n    }\n    irPerfil() {\n      this.router.navigate(['/perfil']);\n    }\n    get esAdmin() {\n      const roles = this.authService.getRoles();\n      return (roles || []).some(r => String(r).toUpperCase() === 'ADMIN' || String(r).toUpperCase() === 'ADMINISTRADOR');\n    }\n    toggleMobileMenu() {\n      this.mobileMenuOpen = !this.mobileMenuOpen;\n    }\n    cerrarMobileMenu() {\n      this.mobileMenuOpen = false;\n    }\n    static {\n      this.ɵfac = function AppComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || AppComponent)(i0.ɵɵdirectiveInject(i1.AuthService), i0.ɵɵdirectiveInject(i2.RentaService), i0.ɵɵdirectiveInject(i3.NotificacionService), i0.ɵɵdirectiveInject(i4.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: AppComponent,\n        selectors: [[\"app-root\"]],\n        decls: 16,\n        vars: 5,\n        consts: [[\"guestLinks\", \"\"], [1, \"app-nav\"], [1, \"app-nav__inner\"], [\"type\", \"button\", \"aria-label\", \"Abrir men\\u00FA\", 1, \"nav-burger\", 3, \"click\"], [\"aria-hidden\", \"true\", 1, \"nav-burger__bar\"], [\"routerLink\", \"/explorar\", 1, \"brand\", 3, \"click\"], [\"src\", \"favicon.ico\", \"alt\", \"Micro Renta\", 1, \"brand-logo\"], [1, \"brand-name\"], [1, \"spacer\"], [1, \"nav\"], [4, \"ngIf\", \"ngIfElse\"], [\"routerLink\", \"/explorar\", 1, \"nav-link\", 3, \"click\"], [\"routerLink\", \"/inbox\", 1, \"nav-link\", 3, \"click\"], [\"class\", \"nav-badge\", 4, \"ngIf\"], [\"routerLink\", \"/articulos/publicar\", 1, \"nav-link\", \"nav-cta\", 3, \"click\"], [\"routerLink\", \"/perfil\", 1, \"nav-link\", 3, \"click\"], [\"class\", \"nav-link\", \"routerLink\", \"/admin\", 3, \"click\", 4, \"ngIf\"], [1, \"nav-badge\"], [\"routerLink\", \"/admin\", 1, \"nav-link\", 3, \"click\"], [\"routerLink\", \"/login\", 1, \"nav-link\", 3, \"click\"], [\"routerLink\", \"/register\", 1, \"nav-link\", \"nav-cta\", 3, \"click\"]],\n        template: function AppComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            const _r1 = i0.ɵɵgetCurrentView();\n            i0.ɵɵelementStart(0, \"header\", 1)(1, \"div\", 2)(2, \"button\", 3);\n            i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_2_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.toggleMobileMenu());\n            });\n            i0.ɵɵelement(3, \"span\", 4)(4, \"span\", 4)(5, \"span\", 4);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(6, \"a\", 5);\n            i0.ɵɵlistener(\"click\", function AppComponent_Template_a_click_6_listener() {\n              i0.ɵɵrestoreView(_r1);\n              return i0.ɵɵresetView(ctx.cerrarMobileMenu());\n            });\n            i0.ɵɵelement(7, \"img\", 6);\n            i0.ɵɵelementStart(8, \"span\", 7);\n            i0.ɵɵtext(9, \"Micro Renta\");\n            i0.ɵɵelementEnd()();\n            i0.ɵɵelement(10, \"div\", 8);\n            i0.ɵɵelementStart(11, \"nav\", 9);\n            i0.ɵɵtemplate(12, AppComponent_ng_container_12_Template, 11, 2, \"ng-container\", 10)(13, AppComponent_ng_template_13_Template, 4, 0, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n            i0.ɵɵelementEnd()()();\n            i0.ɵɵelement(15, \"router-outlet\");\n          }\n          if (rf & 2) {\n            const guestLinks_r6 = i0.ɵɵreference(14);\n            i0.ɵɵadvance(2);\n            i0.ɵɵattribute(\"aria-expanded\", ctx.mobileMenuOpen);\n            i0.ɵɵadvance(9);\n            i0.ɵɵclassProp(\"open\", ctx.mobileMenuOpen);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.authService.isAuthenticated())(\"ngIfElse\", guestLinks_r6);\n          }\n        },\n        dependencies: [i5.NgIf, i4.RouterOutlet, i4.RouterLink],\n        styles: [\".app-nav[_ngcontent-%COMP%]{position:sticky;top:0;z-index:50;background:#f8fafcd1;backdrop-filter:blur(12px);border-bottom:1px solid var(--color-border)}.app-nav__inner[_ngcontent-%COMP%]{max-width:var(--container);margin:0 auto;padding:12px var(--space-2);display:flex;align-items:center;gap:10px;position:relative}.brand[_ngcontent-%COMP%]{display:inline-flex;align-items:center;gap:10px;color:var(--color-text);text-decoration:none;font-weight:850;letter-spacing:-.02em}.brand[_ngcontent-%COMP%]:hover{text-decoration:none}.brand-logo[_ngcontent-%COMP%]{width:28px;height:28px;border-radius:8px;border:1px solid var(--color-border);background:#fff}.brand-name[_ngcontent-%COMP%]{font-size:15px}.nav-burger[_ngcontent-%COMP%]{width:42px;height:42px;border-radius:12px;border:1px solid var(--color-border);background:#0f172a08;display:inline-flex;flex-direction:column;align-items:center;justify-content:center;gap:5px;padding:0}.nav-burger__bar[_ngcontent-%COMP%]{width:18px;height:2px;border-radius:2px;background:#0f172aa6}.nav[_ngcontent-%COMP%]{display:none;align-items:center;gap:10px}.nav.open[_ngcontent-%COMP%]{display:flex;position:absolute;left:0;right:0;top:calc(100% + 8px);padding:12px;background:#fffffff5;border:1px solid var(--color-border);border-radius:16px;box-shadow:var(--shadow-2);flex-direction:column;align-items:stretch}.nav-link[_ngcontent-%COMP%]{display:inline-flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;min-height:44px;border-radius:12px;color:var(--color-text);text-decoration:none;border:1px solid transparent;background:transparent;font-weight:700}.nav-link[_ngcontent-%COMP%]:hover{background:#0f172a08;border-color:var(--color-border);text-decoration:none}.nav-cta[_ngcontent-%COMP%]{background:#14b8a624;border-color:#14b8a64d}.nav-cta[_ngcontent-%COMP%]:hover{background:#14b8a62e}.nav-badge[_ngcontent-%COMP%]{display:inline-flex;min-width:22px;height:22px;padding:0 7px;border-radius:999px;background:#14b8a62e;border:1px solid rgba(20,184,166,.3);font-size:12px;font-weight:800;color:#05201f}@media (min-width: 900px){.nav-burger[_ngcontent-%COMP%]{display:none}.nav[_ngcontent-%COMP%]{display:flex;position:static;padding:0;background:transparent;border:none;box-shadow:none;flex-direction:row;align-items:center}.nav-link[_ngcontent-%COMP%]{padding:8px 10px;border-radius:999px}}\"]\n      });\n    }\n  }\n  return AppComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}