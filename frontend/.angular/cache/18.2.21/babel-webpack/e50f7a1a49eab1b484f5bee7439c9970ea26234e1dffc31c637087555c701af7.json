{"ast":null,"code":"import { __decorate } from \"tslib\";\nimport { Component } from '@angular/core';\nlet PerfilComponent = class PerfilComponent {\n  constructor(authService, articuloService, usuarioService, notificacionService, router) {\n    this.authService = authService;\n    this.articuloService = articuloService;\n    this.usuarioService = usuarioService;\n    this.notificacionService = notificacionService;\n    this.router = router;\n    this.user = null;\n    this.rating = null;\n    this.articulos = [];\n    this.notificaciones = [];\n    this.unreadCount = 0;\n    this.loadingUser = false;\n    this.loadingArticulos = false;\n    this.loadingNotificaciones = false;\n    this.errorMessage = '';\n  }\n  ngOnInit() {\n    this.cargarPerfil();\n    this.cargarMisArticulos();\n    this.cargarNotificaciones();\n  }\n  cargarNotificaciones() {\n    this.loadingNotificaciones = true;\n    this.notificacionService.listar().subscribe({\n      next: data => {\n        this.notificaciones = data.items ?? [];\n        this.unreadCount = Number(data.unread_count ?? 0);\n        this.loadingNotificaciones = false;\n      },\n      error: err => {\n        this.loadingNotificaciones = false;\n        if (err?.status === 401 || err?.status === 422) {\n          this.authService.logout();\n          this.router.navigate(['/login']);\n          return;\n        }\n        // notificaciones son opcionales en UI\n      }\n    });\n  }\n  marcarNotificacionLeida(n) {\n    if (!n || n.leida) return;\n    this.notificacionService.marcarLeida(n.id).subscribe({\n      next: () => {\n        n.leida = true;\n        this.unreadCount = Math.max(0, (this.unreadCount ?? 0) - 1);\n      },\n      error: () => {\n        // best-effort\n      }\n    });\n  }\n  abrirNotificacion(n) {\n    const meta = n?.meta;\n    const link = meta?.link;\n    const chat = meta?.chat === true;\n    const idRenta = meta?.id_renta ?? meta?.renta_id;\n    if (link) {\n      if (chat) {\n        this.router.navigate([link], {\n          queryParams: {\n            chat: 1\n          },\n          fragment: 'chat'\n        });\n      } else {\n        this.router.navigate([link]);\n      }\n      this.marcarNotificacionLeida(n);\n      return;\n    }\n    if (idRenta) {\n      this.router.navigate(['/rentas/resumen', idRenta]);\n      this.marcarNotificacionLeida(n);\n    }\n  }\n  cargarPerfil() {\n    this.loadingUser = true;\n    this.errorMessage = '';\n    this.authService.me().subscribe({\n      next: resp => {\n        this.user = resp.data;\n        this.rating = null;\n        const id = Number(this.user?.id);\n        if (Number.isFinite(id) && id > 0) {\n          this.usuarioService.obtenerRating(id).subscribe({\n            next: r => this.rating = r,\n            error: () => {\n              // rating es opcional en UI\n            }\n          });\n        }\n        this.loadingUser = false;\n      },\n      error: err => {\n        this.loadingUser = false;\n        if (err?.status === 401 || err?.status === 422) {\n          this.authService.logout();\n          this.router.navigate(['/login']);\n          return;\n        }\n        this.errorMessage = 'No se pudo cargar tu perfil.';\n      }\n    });\n  }\n  cargarMisArticulos() {\n    this.loadingArticulos = true;\n    this.articuloService.misArticulos().subscribe({\n      next: arts => {\n        this.articulos = arts;\n        this.loadingArticulos = false;\n      },\n      error: err => {\n        this.loadingArticulos = false;\n        if (err?.status === 401 || err?.status === 422) {\n          this.authService.logout();\n          this.router.navigate(['/login']);\n          return;\n        }\n        this.errorMessage = 'No se pudieron cargar tus art√≠culos.';\n      }\n    });\n  }\n  irAPublicar() {\n    this.router.navigate(['/articulos/publicar']);\n  }\n  irADetalle(art) {\n    this.router.navigate(['/articulos', art.id]);\n  }\n  irAExplorar() {\n    this.router.navigate(['/explorar']);\n  }\n  cerrarSesion() {\n    this.authService.logout();\n    this.router.navigate(['/login']);\n  }\n};\nPerfilComponent = __decorate([Component({\n  selector: 'app-perfil',\n  templateUrl: './perfil.component.html',\n  styleUrls: ['./perfil.component.scss']\n})], PerfilComponent);\nexport { PerfilComponent };","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}