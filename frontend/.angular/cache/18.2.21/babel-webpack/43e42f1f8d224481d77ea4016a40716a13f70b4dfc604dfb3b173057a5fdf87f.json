{"ast":null,"code":"import { Validators } from '@angular/forms';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"@angular/forms\";\nimport * as i3 from \"src/app/core/services/articulo.service\";\nimport * as i4 from \"src/app/core/services/auth.service\";\nimport * as i5 from \"src/app/core/services/renta.service\";\nimport * as i6 from \"@angular/common\";\nfunction RentarArticuloComponent_ng_container_8_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r1 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 7);\n    i0.ɵɵtext(2, \" Acci\\u00F3n no disponible para administradores. \");\n    i0.ɵɵelementStart(3, \"div\", 8)(4, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function RentarArticuloComponent_ng_container_8_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r1);\n      const ctx_r1 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r1.irAExplorar());\n    });\n    i0.ɵɵtext(5, \"Volver a Explorar\");\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementContainerEnd();\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \"Cargando...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.errorMessage, \" \");\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵlistener(\"click\", function RentarArticuloComponent_ng_container_9_div_3_Template_div_click_0_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.cerrarGateModal());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_div_4_div_21_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r1.gateMessage);\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_div_4_div_22_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13);\n    i0.ɵɵtext(1, \" En desarrollo puedes abrir el link aqu\\u00ED: \");\n    i0.ɵɵelementStart(2, \"a\", 23);\n    i0.ɵɵtext(3, \"Abrir verificaci\\u00F3n\");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"href\", ctx_r1.gateVerificationLink, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 15)(1, \"div\", 16)(2, \"div\", 17)(3, \"h3\");\n    i0.ɵɵtext(4, \"Antes de rentar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function RentarArticuloComponent_ng_container_9_div_4_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.cerrarGateModal());\n    });\n    i0.ɵɵtext(6, \"Cerrar\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"p\", 18);\n    i0.ɵɵtext(8, \"Completa estos requisitos para continuar:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 19)(10, \"div\", 20);\n    i0.ɵɵtext(11, \" Correo verificado \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"div\", 20);\n    i0.ɵɵtext(13, \" Tel\\u00E9fono \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"div\", 20);\n    i0.ɵɵtext(15, \" Ubicaci\\u00F3n (ciudad/estado/pa\\u00EDs) \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\", 21)(17, \"button\", 4);\n    i0.ɵɵlistener(\"click\", function RentarArticuloComponent_ng_container_9_div_4_Template_button_click_17_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.gateIrAPerfil());\n    });\n    i0.ɵɵtext(18, \"Ir a Perfil\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"button\", 22);\n    i0.ɵɵlistener(\"click\", function RentarArticuloComponent_ng_container_9_div_4_Template_button_click_19_listener() {\n      i0.ɵɵrestoreView(_r4);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.gateEnviarVerificacion());\n    });\n    i0.ɵɵtext(20);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(21, RentarArticuloComponent_ng_container_9_div_4_div_21_Template, 2, 1, \"div\", 9)(22, RentarArticuloComponent_ng_container_9_div_4_div_22_Template, 4, 1, \"div\", 9);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(10);\n    i0.ɵɵclassProp(\"done\", ctx_r1.gateMissing.indexOf(\"correo_verificado\") === -1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"done\", ctx_r1.gateMissing.indexOf(\"telefono\") === -1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"done\", ctx_r1.gateMissing.indexOf(\"ubicacion\") === -1);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"disabled\", ctx_r1.gateSendingVerification || ctx_r1.gateMissing.indexOf(\"correo_verificado\") === -1);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.gateSendingVerification ? \"Enviando...\" : \"Enviar verificaci\\u00F3n\", \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.gateMessage);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.gateVerificationLink);\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_ng_container_5_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 37);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    let tmp_4_0;\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" $\", ctx_r1.modalidad === \"horas\" ? (tmp_4_0 = ctx_r1.articulo.precio_renta_hora) !== null && tmp_4_0 !== undefined ? tmp_4_0 : ctx_r1.articulo.precio_base : (tmp_4_0 = ctx_r1.articulo.precio_renta_dia) !== null && tmp_4_0 !== undefined ? tmp_4_0 : ctx_r1.articulo.precio_base, \" / \", ctx_r1.modalidad === \"horas\" ? \"hora\" : \"d\\u00EDa\", \" \");\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_ng_container_5_ng_template_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 37);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\" $\", ctx_r1.articulo.precio_base, \" / \", ctx_r1.articulo.unidad_precio === \"por_hora\" ? \"hora\" : ctx_r1.articulo.unidad_precio === \"por_semana\" ? \"semana\" : \"d\\u00EDa\", \" \");\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_ng_container_5_div_7_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const o_r6 = ctx.$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate2(\"\", o_r6.inicio, \" \\u2192 \", o_r6.fin, \"\");\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_ng_container_5_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 13)(1, \"strong\");\n    i0.ɵɵtext(2, \"No disponible en:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, RentarArticuloComponent_ng_container_9_ng_container_5_div_7_div_3_Template, 2, 2, \"div\", 38);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r1.ocupacion);\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_ng_container_5_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 7);\n    i0.ɵɵtext(1, \" No puedes rentar tu propio art\\u00EDculo. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_ng_container_5_div_29_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"No disponible por d\\u00EDa.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_ng_container_5_div_29_span_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \"No disponible por hora.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_ng_container_5_div_29_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 39);\n    i0.ɵɵtemplate(1, RentarArticuloComponent_ng_container_9_ng_container_5_div_29_span_1_Template, 2, 0, \"span\", 6)(2, RentarArticuloComponent_ng_container_9_ng_container_5_div_29_span_2_Template, 2, 0, \"span\", 6);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.permiteDias);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.permiteHoras);\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_ng_container_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵelementStart(1, \"div\", 24)(2, \"div\", 25);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(4, RentarArticuloComponent_ng_container_9_ng_container_5_div_4_Template, 2, 2, \"div\", 26)(5, RentarArticuloComponent_ng_container_9_ng_container_5_ng_template_5_Template, 2, 2, \"ng-template\", null, 0, i0.ɵɵtemplateRefExtractor);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, RentarArticuloComponent_ng_container_9_ng_container_5_div_7_Template, 4, 1, \"div\", 9);\n    i0.ɵɵelementStart(8, \"div\", 13);\n    i0.ɵɵtext(9, \" La entrega/devoluci\\u00F3n se coordina despu\\u00E9s del pago. \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(10, RentarArticuloComponent_ng_container_9_ng_container_5_div_10_Template, 2, 0, \"div\", 10);\n    i0.ɵɵelementStart(11, \"form\", 27);\n    i0.ɵɵlistener(\"ngSubmit\", function RentarArticuloComponent_ng_container_9_ng_container_5_Template_form_ngSubmit_11_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.confirmarRenta());\n    });\n    i0.ɵɵelementStart(12, \"div\", 28)(13, \"div\", 29)(14, \"label\");\n    i0.ɵɵtext(15, \"Inicio\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(16, \"input\", 30);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(17, \"div\", 29)(18, \"label\");\n    i0.ɵɵtext(19, \"Fin\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(20, \"input\", 31);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(21, \"div\", 29)(22, \"label\");\n    i0.ɵɵtext(23, \"Modalidad\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"select\", 32);\n    i0.ɵɵlistener(\"change\", function RentarArticuloComponent_ng_container_9_ng_container_5_Template_select_change_24_listener($event) {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r1 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r1.onModalidadChange($event.target.value));\n    });\n    i0.ɵɵelementStart(25, \"option\", 33);\n    i0.ɵɵtext(26, \"D\\u00EDas\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(27, \"option\", 34);\n    i0.ɵɵtext(28, \"Horas\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(29, RentarArticuloComponent_ng_container_9_ng_container_5_div_29_Template, 3, 2, \"div\", 35);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(30, \"button\", 36);\n    i0.ɵɵtext(31);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const soloBase_r7 = i0.ɵɵreference(6);\n    const ctx_r1 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r1.articulo.titulo);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.permiteDias || ctx_r1.permiteHoras)(\"ngIfElse\", soloBase_r7);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.ocupacion.length > 0);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.esMio);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"formGroup\", ctx_r1.form);\n    i0.ɵɵadvance(5);\n    i0.ɵɵattribute(\"step\", ctx_r1.modalidad === \"horas\" ? 3600 : 60);\n    i0.ɵɵadvance(4);\n    i0.ɵɵattribute(\"step\", ctx_r1.modalidad === \"horas\" ? 3600 : 60);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"value\", ctx_r1.modalidad)(\"disabled\", ctx_r1.loading);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", !ctx_r1.permiteDias);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"disabled\", !ctx_r1.permiteHoras);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.permiteDias || !ctx_r1.permiteHoras);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r1.loading || ctx_r1.esMio);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r1.loading ? \"Creando...\" : \"Confirmar renta\", \" \");\n  }\n}\nfunction RentarArticuloComponent_ng_container_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, RentarArticuloComponent_ng_container_9_div_1_Template, 2, 0, \"div\", 9)(2, RentarArticuloComponent_ng_container_9_div_2_Template, 2, 1, \"div\", 10)(3, RentarArticuloComponent_ng_container_9_div_3_Template, 1, 0, \"div\", 11)(4, RentarArticuloComponent_ng_container_9_div_4_Template, 23, 10, \"div\", 12)(5, RentarArticuloComponent_ng_container_9_ng_container_5_Template, 32, 15, \"ng-container\", 6);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r1 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.loading);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.loading && ctx_r1.errorMessage);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.gateOpen);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r1.gateOpen);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r1.loading && ctx_r1.articulo);\n  }\n}\nexport let RentarArticuloComponent = /*#__PURE__*/(() => {\n  class RentarArticuloComponent {\n    constructor(route, router, fb, articuloService, authService, rentaService) {\n      this.route = route;\n      this.router = router;\n      this.fb = fb;\n      this.articuloService = articuloService;\n      this.authService = authService;\n      this.rentaService = rentaService;\n      this.loading = false;\n      this.errorMessage = '';\n      this.requiresProfile = false;\n      this.adminBlocked = false;\n      this.gateOpen = false;\n      this.gateMissing = [];\n      this.gateSendingVerification = false;\n      this.gateMessage = '';\n      this.gateVerificationLink = '';\n      this.ocupacion = [];\n      this.articulo = null;\n      this.esMio = false;\n      this.modalidad = 'dias';\n      this.permiteHoras = false;\n      this.permiteDias = true;\n      this.form = this.fb.group({\n        fecha_inicio: ['', [Validators.required]],\n        fecha_fin: ['', [Validators.required]]\n      });\n    }\n    ngOnInit() {\n      if (this.esAdmin) {\n        this.adminBlocked = true;\n        return;\n      }\n      const id = Number(this.route.snapshot.paramMap.get('id'));\n      if (!Number.isFinite(id) || id <= 0) {\n        this.errorMessage = 'ID de artículo inválido.';\n        return;\n      }\n      this.cargarArticulo(id);\n    }\n    get esAdmin() {\n      const roles = this.authService.getRoles();\n      return roles.some(r => {\n        const v = String(r).toUpperCase();\n        return v === 'ADMIN' || v === 'ADMINISTRADOR';\n      });\n    }\n    irAExplorar() {\n      this.router.navigate(['/explorar']);\n    }\n    volverDetalle() {\n      if (!this.articulo) {\n        this.router.navigate(['/explorar']);\n        return;\n      }\n      this.router.navigate(['/articulos', this.articulo.id]);\n    }\n    confirmarRenta() {\n      if (this.adminBlocked) {\n        this.errorMessage = 'Acción no disponible para administradores.';\n        return;\n      }\n      this.errorMessage = '';\n      this.requiresProfile = false;\n      this.ocupacion = [];\n      if (!this.articulo) return;\n      this.gateOpen = false;\n      this.gateMissing = [];\n      this.gateMessage = '';\n      const articuloId = this.articulo.id;\n      if (this.esMio) {\n        this.errorMessage = 'No puedes rentar tu propio artículo.';\n        return;\n      }\n      if (this.form.invalid) {\n        this.form.markAllAsTouched();\n        this.errorMessage = 'Completa las fechas.';\n        return;\n      }\n      const inicioRaw = this.form.value.fecha_inicio ?? '';\n      const finRaw = this.form.value.fecha_fin ?? '';\n      const inicio = new Date(inicioRaw);\n      const fin = new Date(finRaw);\n      if (!(inicio instanceof Date) || isNaN(inicio.getTime()) || isNaN(fin.getTime())) {\n        this.errorMessage = 'Fechas inválidas.';\n        return;\n      }\n      if (this.modalidad === 'horas') {\n        if (inicio.getMinutes() !== 0 || fin.getMinutes() !== 0) {\n          this.errorMessage = 'Solo se permiten horas exactas (sin minutos).';\n          return;\n        }\n        const diffMs = fin.getTime() - inicio.getTime();\n        if (diffMs < 60 * 60 * 1000) {\n          this.errorMessage = 'La renta por horas debe ser de al menos 1 hora.';\n          return;\n        }\n        if (diffMs % (60 * 60 * 1000) !== 0) {\n          this.errorMessage = 'Solo se permiten horas exactas (sin minutos).';\n          return;\n        }\n      }\n      if (fin <= inicio) {\n        this.errorMessage = 'La fecha fin debe ser posterior a la fecha inicio.';\n        return;\n      }\n      this.validarGateAntesDeRentar(() => this.continuarConfirmarRenta(articuloId, inicio, fin));\n    }\n    continuarConfirmarRenta(articuloId, inicio, fin) {\n      this.loading = true;\n      const toYMDLocal = d => {\n        const pad = n => String(n).padStart(2, '0');\n        return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}`;\n      };\n      this.articuloService.getOcupacion(articuloId, toYMDLocal(inicio), toYMDLocal(fin)).subscribe({\n        next: ocupado => {\n          this.ocupacion = ocupado;\n          const overlaps = (ocupado ?? []).filter(o => {\n            const oInicio = new Date(o.inicio);\n            const oFin = new Date(o.fin);\n            if (isNaN(oInicio.getTime()) || isNaN(oFin.getTime())) return false;\n            return inicio < oFin && fin > oInicio;\n          });\n          if (overlaps.length > 0) {\n            this.loading = false;\n            this.errorMessage = 'El artículo no está disponible en el rango seleccionado.';\n            return;\n          }\n          this.rentaService.crearRenta({\n            id_articulo: articuloId,\n            fecha_inicio: inicio.toISOString(),\n            fecha_fin: fin.toISOString(),\n            modalidad: this.modalidad\n          }).subscribe({\n            next: r => {\n              this.loading = false;\n              const idRenta = r.id_renta ?? r.id;\n              this.router.navigate(['/rentas/resumen', idRenta]);\n            },\n            error: err => {\n              this.loading = false;\n              const status = err?.status;\n              const hasToken = !!this.authService.getToken();\n              if ((status === 401 || status === 422) && !hasToken) {\n                this.router.navigate(['/login']);\n                return;\n              }\n              if (status === 403 && err?.error?.payload?.code === 'PROFILE_INCOMPLETE') {\n                this.abrirGateModal(err?.error?.payload?.missing ?? []);\n                return;\n              }\n              if (status === 403 && err?.error?.payload?.code === 'ADMIN_FORBIDDEN') {\n                this.errorMessage = 'Acción no disponible para administradores.';\n                this.adminBlocked = true;\n                return;\n              }\n              this.errorMessage = err?.error?.message || 'No se pudo crear la renta.';\n            }\n          });\n        },\n        error: err => {\n          // Si falla ocupación, no bloqueamos el flujo: dejamos que backend valide traslapes.\n          this.rentaService.crearRenta({\n            id_articulo: articuloId,\n            fecha_inicio: inicio.toISOString(),\n            fecha_fin: fin.toISOString(),\n            modalidad: this.modalidad\n          }).subscribe({\n            next: r => {\n              this.loading = false;\n              const idRenta = r.id_renta ?? r.id;\n              this.router.navigate(['/rentas/resumen', idRenta]);\n            },\n            error: err2 => {\n              this.loading = false;\n              const status = err2?.status;\n              const hasToken = !!this.authService.getToken();\n              if ((status === 401 || status === 422) && !hasToken) {\n                this.router.navigate(['/login']);\n                return;\n              }\n              if (status === 403 && err2?.error?.payload?.code === 'PROFILE_INCOMPLETE') {\n                this.abrirGateModal(err2?.error?.payload?.missing ?? []);\n                return;\n              }\n              if (status === 403 && err2?.error?.payload?.code === 'ADMIN_FORBIDDEN') {\n                this.errorMessage = 'Acción no disponible para administradores.';\n                this.adminBlocked = true;\n                return;\n              }\n              this.errorMessage = err2?.error?.message || 'No se pudo crear la renta.';\n            }\n          });\n        }\n      });\n    }\n    validarGateAntesDeRentar(onOk) {\n      if (!this.authService.getToken()) {\n        this.router.navigate(['/login']);\n        return;\n      }\n      this.authService.me().subscribe({\n        next: resp => {\n          const me = resp?.data;\n          const missing = [];\n          const emailOk = !!(me?.email_verificado ?? me?.verificado);\n          if (!emailOk) missing.push('correo_verificado');\n          const tel = String(me?.telefono ?? '').trim();\n          if (!tel) missing.push('telefono');\n          const ciudad = String(me?.ciudad ?? '').trim();\n          const estado = String(me?.estado ?? '').trim();\n          const pais = String(me?.pais ?? '').trim();\n          if (!(ciudad && estado && pais)) missing.push('ubicacion');\n          if (missing.length > 0) {\n            this.abrirGateModal(missing);\n            return;\n          }\n          onOk();\n        },\n        error: () => {\n          // Si falla el pre-check, dejamos que backend valide.\n          onOk();\n        }\n      });\n    }\n    abrirGateModal(missing) {\n      this.gateMissing = Array.isArray(missing) ? missing.map(x => String(x)) : [];\n      this.gateOpen = true;\n      this.gateMessage = '';\n      this.gateVerificationLink = '';\n    }\n    cerrarGateModal() {\n      this.gateOpen = false;\n    }\n    gateIrAPerfil() {\n      this.gateOpen = false;\n      this.router.navigate(['/perfil']);\n    }\n    gateEnviarVerificacion() {\n      this.gateMessage = '';\n      this.gateVerificationLink = '';\n      if (this.gateSendingVerification) return;\n      this.gateSendingVerification = true;\n      this.authService.enviarVerificacionEmail().subscribe({\n        next: resp => {\n          this.gateSendingVerification = false;\n          this.gateVerificationLink = String(resp?.data?.link ?? '').trim();\n          this.gateMessage = resp?.message || 'Link de verificación enviado.';\n        },\n        error: err => {\n          this.gateSendingVerification = false;\n          this.gateMessage = err?.error?.message || 'No se pudo enviar el link de verificación.';\n        }\n      });\n    }\n    irAPerfil() {\n      this.router.navigate(['/perfil']);\n    }\n    cargarArticulo(id) {\n      this.loading = true;\n      this.articuloService.getArticuloPorId(id).subscribe({\n        next: art => {\n          this.articulo = art;\n          const userId = this.authService.getUserId();\n          this.esMio = !!userId && Number(art?.id_propietario) === userId;\n          const precioHora = Number(art?.precio_renta_hora ?? NaN);\n          const precioDia = Number(art?.precio_renta_dia ?? NaN);\n          this.permiteHoras = Number.isFinite(precioHora) && precioHora > 0;\n          this.permiteDias = Number.isFinite(precioDia) && precioDia > 0;\n          // fallback: legacy artículos por hora sin precio_renta_hora\n          if (!this.permiteHoras && art?.unidad_precio === 'por_hora') {\n            const legacy = Number(art?.precio_renta_dia ?? NaN);\n            this.permiteHoras = Number.isFinite(legacy) && legacy > 0;\n          }\n          if (this.permiteDias) {\n            this.modalidad = 'dias';\n          } else if (this.permiteHoras) {\n            this.modalidad = 'horas';\n          } else {\n            this.modalidad = 'dias';\n          }\n          this.loading = false;\n        },\n        error: err => {\n          this.loading = false;\n          const status = err?.status;\n          const hasToken = !!this.authService.getToken();\n          if ((status === 401 || status === 422) && !hasToken) {\n            this.router.navigate(['/login']);\n            return;\n          }\n          this.errorMessage = err?.error?.message || 'No se pudo cargar el artículo.';\n        }\n      });\n    }\n    onModalidadChange(value) {\n      this.modalidad = value === 'horas' ? 'horas' : 'dias';\n      if (this.modalidad !== 'horas') return;\n      // UX: si ya hay valores, intentar llevarlos a hora exacta (minutos=00)\n      const inicioRaw = this.form.value.fecha_inicio ?? '';\n      const finRaw = this.form.value.fecha_fin ?? '';\n      const inicio = inicioRaw ? new Date(inicioRaw) : null;\n      const fin = finRaw ? new Date(finRaw) : null;\n      const roundToHour = d => {\n        const copy = new Date(d);\n        copy.setMinutes(0, 0, 0);\n        return copy;\n      };\n      const toLocalInputValue = d => {\n        const pad = n => String(n).padStart(2, '0');\n        return `${d.getFullYear()}-${pad(d.getMonth() + 1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;\n      };\n      const patch = {};\n      if (inicio && !isNaN(inicio.getTime())) {\n        patch.fecha_inicio = toLocalInputValue(roundToHour(inicio));\n      }\n      if (fin && !isNaN(fin.getTime())) {\n        patch.fecha_fin = toLocalInputValue(roundToHour(fin));\n      }\n      if (Object.keys(patch).length > 0) {\n        this.form.patchValue(patch);\n      }\n    }\n    static {\n      this.ɵfac = function RentarArticuloComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || RentarArticuloComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.FormBuilder), i0.ɵɵdirectiveInject(i3.ArticuloService), i0.ɵɵdirectiveInject(i4.AuthService), i0.ɵɵdirectiveInject(i5.RentaService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: RentarArticuloComponent,\n        selectors: [[\"app-rentar-articulo\"]],\n        decls: 10,\n        vars: 2,\n        consts: [[\"soloBase\", \"\"], [1, \"page-wrapper\"], [1, \"card\"], [1, \"card-header\"], [\"type\", \"button\", 1, \"btn-secondary\", 3, \"click\"], [1, \"spacer\"], [4, \"ngIf\"], [1, \"state-message\", \"error\"], [1, \"actions\"], [\"class\", \"state-message\", 4, \"ngIf\"], [\"class\", \"state-message error\", 4, \"ngIf\"], [\"class\", \"gate-backdrop\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"gate-modal\", \"role\", \"dialog\", \"aria-modal\", \"true\", 4, \"ngIf\"], [1, \"state-message\"], [1, \"gate-backdrop\", 3, \"click\"], [\"role\", \"dialog\", \"aria-modal\", \"true\", 1, \"gate-modal\"], [1, \"gate-card\"], [1, \"gate-head\"], [1, \"modal-sub\"], [1, \"checklist\"], [1, \"check\"], [1, \"gate-actions\"], [\"type\", \"button\", 1, \"btn-primary\", 3, \"click\", \"disabled\"], [\"target\", \"_blank\", \"rel\", \"noopener noreferrer\", 3, \"href\"], [1, \"resumen\"], [1, \"titulo\"], [\"class\", \"precio\", 4, \"ngIf\", \"ngIfElse\"], [1, \"form\", 3, \"ngSubmit\", \"formGroup\"], [1, \"form-grid\"], [1, \"form-row\"], [\"type\", \"datetime-local\", \"formControlName\", \"fecha_inicio\"], [\"type\", \"datetime-local\", \"formControlName\", \"fecha_fin\"], [3, \"change\", \"value\", \"disabled\"], [\"value\", \"dias\", 3, \"disabled\"], [\"value\", \"horas\", 3, \"disabled\"], [\"class\", \"hint\", 4, \"ngIf\"], [\"type\", \"submit\", 1, \"btn-primary\", 3, \"disabled\"], [1, \"precio\"], [4, \"ngFor\", \"ngForOf\"], [1, \"hint\"]],\n        template: function RentarArticuloComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 1)(1, \"section\", 2)(2, \"div\", 3)(3, \"button\", 4);\n            i0.ɵɵlistener(\"click\", function RentarArticuloComponent_Template_button_click_3_listener() {\n              return ctx.volverDetalle();\n            });\n            i0.ɵɵtext(4, \"Volver\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"h2\");\n            i0.ɵɵtext(6, \"Rentar\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(7, \"div\", 5);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(8, RentarArticuloComponent_ng_container_8_Template, 6, 0, \"ng-container\", 6)(9, RentarArticuloComponent_ng_container_9_Template, 6, 5, \"ng-container\", 6);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(8);\n            i0.ɵɵproperty(\"ngIf\", ctx.adminBlocked);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.adminBlocked);\n          }\n        },\n        dependencies: [i6.NgForOf, i6.NgIf, i2.ɵNgNoValidate, i2.NgSelectOption, i2.ɵNgSelectMultipleOption, i2.DefaultValueAccessor, i2.NgControlStatus, i2.NgControlStatusGroup, i2.FormGroupDirective, i2.FormControlName],\n        styles: [\".card[_ngcontent-%COMP%]{max-width:900px;margin:0 auto}.form[_ngcontent-%COMP%] > .btn-primary[_ngcontent-%COMP%]{width:100%}.resumen[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:space-between;gap:10px;padding:12px;border:1px solid var(--border);border-radius:12px;background:var(--surface-2);margin-bottom:12px}.titulo[_ngcontent-%COMP%], .precio[_ngcontent-%COMP%]{font-weight:800;color:var(--text)}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px}.form-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}.form-row[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:6px}.hint[_ngcontent-%COMP%]{font-size:12px;color:var(--muted);display:flex;gap:10px}.gate-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0206178c;z-index:1000}.gate-modal[_ngcontent-%COMP%]{position:fixed;inset:0;display:grid;place-items:center;padding:16px;z-index:1001}.gate-card[_ngcontent-%COMP%]{width:min(560px,100vw - 32px);border:1px solid var(--border);border-radius:16px;background:var(--surface-1);box-shadow:var(--shadow-2);padding:14px}.gate-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:10px}.gate-head[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px}.modal-sub[_ngcontent-%COMP%]{margin:8px 0 12px;color:var(--muted);font-size:13px}.checklist[_ngcontent-%COMP%]{display:grid;gap:8px;margin-bottom:12px}.check[_ngcontent-%COMP%]{padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--surface-2);font-weight:700;color:var(--text)}.check.done[_ngcontent-%COMP%]{opacity:.65}.gate-actions[_ngcontent-%COMP%]{display:flex;gap:10px;justify-content:flex-end;flex-wrap:wrap}label[_ngcontent-%COMP%]{font-size:13px;font-weight:700;color:var(--text)}@media (max-width: 600px){.form-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}\"]\n      });\n    }\n  }\n  return RentarArticuloComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}