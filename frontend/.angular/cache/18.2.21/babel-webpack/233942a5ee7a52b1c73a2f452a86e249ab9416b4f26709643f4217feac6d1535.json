{"ast":null,"code":"import _asyncToGenerator from \"C:/Users/sergi/OneDrive/Escritorio/micro-renta-objetos/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { FormControl, Validators } from '@angular/forms';\nimport { firstValueFrom, interval, startWith, switchMap, tap } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/router\";\nimport * as i2 from \"src/app/core/services/renta.service\";\nimport * as i3 from \"src/app/core/services/auth.service\";\nimport * as i4 from \"src/app/core/services/badge.service\";\nimport * as i5 from \"src/app/core/services/punto-entrega.service\";\nimport * as i6 from \"@angular/common\";\nimport * as i7 from \"@angular/forms\";\nconst _c0 = [\"entregaAccordion\"];\nconst _c1 = [\"chatScroll\"];\nfunction RentaResumenComponent_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵtext(1, \"Cargando resumen...\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentaResumenComponent_div_9_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.errorMessage, \" \");\n  }\n}\nfunction RentaResumenComponent_div_10_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.successMessage, \" \");\n  }\n}\nfunction RentaResumenComponent_div_11_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵelement(1, \"span\", 13);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.processingMessage || \"Procesando pago...\", \" \");\n  }\n}\nfunction RentaResumenComponent_div_12_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 14);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵclassProp(\"toast-success\", ctx_r0.toastType === \"success\")(\"toast-error\", ctx_r0.toastType === \"error\");\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.toastMessage, \" \");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"strong\");\n    i0.ɵɵtext(2, \"Reserva expirada.\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3, \" El tiempo para pagar termin\\u00F3. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵtext(1, \" Reembolso simulado: \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\"$\", ctx_r0.renta.monto_reembolso || 0, \"\");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_button_27_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r3 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_button_27_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r3);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.abrirPago());\n    });\n    i0.ɵɵtext(1, \" Pagar ahora \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_li_45_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"li\");\n    i0.ɵɵtext(1);\n    i0.ɵɵelementStart(2, \"span\", 36);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const s_r4 = ctx.$implicit;\n    i0.ɵɵclassProp(\"done\", s_r4.done);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", s_r4.label, \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(s_r4.done ? \"\\u2705\" : \"\\u23F3\");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_46_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵtext(1, \" Paga para habilitar coordinaci\\u00F3n. \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_47_div_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\")(2, \"strong\");\n    i0.ɵɵtext(3, \"Ventana de entrega:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\")(6, \"strong\");\n    i0.ɵɵtext(7, \"Ventana de devoluci\\u00F3n:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(8);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.ventanaEntregaUi || \"-\", \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.ventanaDevolucionUi || \"-\", \"\");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_47_div_2_button_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r6 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 43);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_47_div_2_button_5_Template_button_click_0_listener() {\n      const opt_r7 = i0.ɵɵrestoreView(_r6).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r0.seleccionarEntrega(opt_r7.label));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const opt_r7 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(4);\n    i0.ɵɵclassProp(\"active\", ctx_r0.coordEntregaLabel === opt_r7.label);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.uiBloqueada);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", opt_r7.label, \" \");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_47_div_2_button_10_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 43);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_47_div_2_button_10_Template_button_click_0_listener() {\n      const opt_r9 = i0.ɵɵrestoreView(_r8).$implicit;\n      const ctx_r0 = i0.ɵɵnextContext(4);\n      return i0.ɵɵresetView(ctx_r0.seleccionarDevolucion(opt_r9.label));\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const opt_r9 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(4);\n    i0.ɵɵclassProp(\"active\", ctx_r0.coordDevolucionLabel === opt_r9.label);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.uiBloqueada);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", opt_r9.label, \" \");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_47_div_2_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r0.coordError);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_47_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 38)(1, \"div\", 39)(2, \"div\", 40);\n    i0.ɵɵtext(3, \"Ventana de entrega\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"div\", 41);\n    i0.ɵɵtemplate(5, RentaResumenComponent_ng_container_13_div_47_div_2_button_5_Template, 2, 4, \"button\", 42);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(6, \"div\", 39)(7, \"div\", 40);\n    i0.ɵɵtext(8, \"Ventana de devoluci\\u00F3n\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(9, \"div\", 41);\n    i0.ɵɵtemplate(10, RentaResumenComponent_ng_container_13_div_47_div_2_button_10_Template, 2, 4, \"button\", 42);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(11, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_47_div_2_Template_button_click_11_listener() {\n      i0.ɵɵrestoreView(_r5);\n      const ctx_r0 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r0.confirmarCoordinacionSimple());\n    });\n    i0.ɵɵtext(12, \" Confirmar coordinaci\\u00F3n \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(13, RentaResumenComponent_ng_container_13_div_47_div_2_div_13_Template, 2, 1, \"div\", 8);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.entregaSlotOptions);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.devolucionSlotOptions);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.uiBloqueada);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.coordError);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_47_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵtext(1, \" Coordinaci\\u00F3n confirmada \\u2705 \");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_47_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\");\n    i0.ɵɵtemplate(1, RentaResumenComponent_ng_container_13_div_47_div_1_Template, 9, 2, \"div\", 7)(2, RentaResumenComponent_ng_container_13_div_47_div_2_Template, 14, 4, \"div\", 37)(3, RentaResumenComponent_ng_container_13_div_47_div_3_Template, 2, 0, \"div\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.ventanaEntregaUi || ctx_r0.ventanaDevolucionUi);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", !ctx_r0.coordinacionConfirmadaUi);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.coordinacionConfirmadaUi);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_48_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵtext(1, \"Sin mensajes.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_48_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"strong\");\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const m_r11 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵclassProp(\"error\", m_r11.id_emisor !== ctx_r0.userId);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"\", m_r11.id_emisor === ctx_r0.userId ? \"T\\u00FA\" : \"Otro\", \":\");\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", m_r11.mensaje, \" \");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_48_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r10 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 44)(1, \"div\", 45);\n    i0.ɵɵtext(2, \"Chat de la renta\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 11);\n    i0.ɵɵtext(4, \" Solo texto corto. Sin links, sin tel\\u00E9fonos. \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"div\", 46, 1);\n    i0.ɵɵtemplate(7, RentaResumenComponent_ng_container_13_div_48_div_7_Template, 2, 0, \"div\", 7)(8, RentaResumenComponent_ng_container_13_div_48_div_8_Template, 4, 4, \"div\", 47);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"input\", 48);\n    i0.ɵɵelementStart(10, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_48_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r10);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.enviarChat());\n    });\n    i0.ɵɵtext(11, \" Enviar \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(7);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.chatMessages.length === 0);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.chatMessages);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"formControl\", ctx_r0.chatInputControl)(\"disabled\", !ctx_r0.puedeEnviarChat);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", !ctx_r0.puedeEnviarChat);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_49_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 49)(1, \"div\", 45);\n    i0.ɵɵtext(2, \"Tus c\\u00F3digos (OTP)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 11);\n    i0.ɵɵtext(4, \" Entrega: \");\n    i0.ɵɵelementStart(5, \"strong\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"div\", 11);\n    i0.ɵɵtext(8, \" Devoluci\\u00F3n: \");\n    i0.ɵɵelementStart(9, \"strong\");\n    i0.ɵɵtext(10);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r0.renta.codigo_entrega || \"\\u2014\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate(ctx_r0.renta.codigo_devolucion || \"\\u2014\");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_50_div_3_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r12 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\")(2, \"strong\");\n    i0.ɵɵtext(3, \"Confirmar entrega\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"label\");\n    i0.ɵɵtext(5, \"C\\u00F3digo de entrega\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"input\", 50);\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵtext(8, \"Checklist (opcional)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"textarea\", 51);\n    i0.ɵɵelementStart(10, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_50_div_3_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r12);\n      const ctx_r0 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r0.confirmarEntregaOtp());\n    });\n    i0.ɵɵtext(11, \" Confirmar entrega \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.otpEntregaControl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.checklistEntregaControl);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.uiBloqueada);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_50_div_4_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r13 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\")(2, \"strong\");\n    i0.ɵɵtext(3, \"Confirmar devoluci\\u00F3n\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"label\");\n    i0.ɵɵtext(5, \"C\\u00F3digo de devoluci\\u00F3n\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(6, \"input\", 50);\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵtext(8, \"Checklist (opcional)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(9, \"textarea\", 51);\n    i0.ɵɵelementStart(10, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_50_div_4_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r13);\n      const ctx_r0 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r0.confirmarDevolucionOtp());\n    });\n    i0.ɵɵtext(11, \" Confirmar devoluci\\u00F3n \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.otpDevolucionControl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.checklistDevolucionControl);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.uiBloqueada);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_50_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 49)(1, \"div\", 45);\n    i0.ɵɵtext(2, \"Confirmaci\\u00F3n por OTP (due\\u00F1o)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(3, RentaResumenComponent_ng_container_13_div_50_div_3_Template, 12, 3, \"div\", 7)(4, RentaResumenComponent_ng_container_13_div_50_div_4_Template, 12, 3, \"div\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedeConfirmarEntregaOtp);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedeConfirmarDevolucionOtp);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_details_51_div_5_div_6_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 60);\n    i0.ɵɵtext(1);\n    i0.ɵɵpipe(2, \"date\");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const t_r14 = i0.ɵɵnextContext().$implicit;\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(i0.ɵɵpipeBind2(2, 1, t_r14.date, \"short\"));\n  }\n}\nfunction RentaResumenComponent_ng_container_13_details_51_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 54);\n    i0.ɵɵelement(1, \"div\", 55)(2, \"div\", 56);\n    i0.ɵɵelementStart(3, \"div\", 57)(4, \"div\", 58);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(6, RentaResumenComponent_ng_container_13_details_51_div_5_div_6_Template, 3, 4, \"div\", 59);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const t_r14 = ctx.$implicit;\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵclassProp(\"done\", t_r14.done)(\"alert\", t_r14.key === \"incidente\" && ctx_r0.estadoNormalizado === \"incidente\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate(t_r14.label);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", t_r14.date);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_details_51_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"details\", 24)(1, \"summary\");\n    i0.ɵɵtext(2, \"Historial\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 25)(4, \"div\", 52);\n    i0.ɵɵtemplate(5, RentaResumenComponent_ng_container_13_details_51_div_5_Template, 7, 6, \"div\", 53);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.timeline);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_button_57_span_1_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelement(0, \"span\", 13);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_button_57_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r15 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_button_57_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r15);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.descargarRecibo());\n    });\n    i0.ɵɵtemplate(1, RentaResumenComponent_ng_container_13_button_57_span_1_Template, 1, 0, \"span\", 61);\n    i0.ɵɵtext(2);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.downloadingRecibo);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.downloadingRecibo);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.downloadingRecibo ? \"Descargando...\" : \"Descargar recibo\", \" \");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_button_58_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r16 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_button_58_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r16);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.toggleCancelar());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.showCancelar ? \"Cancelar acci\\u00F3n\" : \"Cancelar renta\", \" \");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_button_59_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r17 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_button_59_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r17);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.confirmarEntrega());\n    });\n    i0.ɵɵtext(1, \" Confirmar entrega \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_button_60_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r18 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_button_60_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r18);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.marcarEnUso());\n    });\n    i0.ɵɵtext(1, \" Marcar en uso \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_button_61_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r19 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_button_61_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r19);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.devolver());\n    });\n    i0.ɵɵtext(1, \" Devolver \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_button_62_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r20 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_button_62_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r20);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.finalizar());\n    });\n    i0.ɵɵtext(1, \" Finalizar (liberar dep\\u00F3sito) \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_button_63_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r21 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_button_63_Template_button_click_0_listener() {\n      i0.ɵɵrestoreView(_r21);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.toggleIncidente());\n    });\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.showIncidente ? \"Cancelar incidente\" : \"Reportar incidente\", \" \");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_66_span_5_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \" El due\\u00F1o debe indicar un motivo.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_66_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r22 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 49)(1, \"div\", 45);\n    i0.ɵɵtext(2, \"Cancelar renta\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 11);\n    i0.ɵɵtext(4, \" Esta acci\\u00F3n es irreversible. \");\n    i0.ɵɵtemplate(5, RentaResumenComponent_ng_container_13_div_66_span_5_Template, 2, 0, \"span\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"label\");\n    i0.ɵɵtext(7, \"Motivo (opcional)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(8, \"textarea\", 62);\n    i0.ɵɵelementStart(9, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_66_Template_button_click_9_listener() {\n      i0.ɵɵrestoreView(_r22);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.confirmarCancelar());\n    });\n    i0.ɵɵtext(10, \" Confirmar cancelaci\\u00F3n \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.soyDueno);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.cancelarMotivoControl);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_67_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r23 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 49)(1, \"label\");\n    i0.ɵɵtext(2, \"Describe el incidente\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"textarea\", 63);\n    i0.ɵɵelementStart(4, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_67_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r23);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.enviarIncidente());\n    });\n    i0.ɵɵtext(5, \" Enviar \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.incidenteControl);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_68_div_5_div_13_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 68)(1, \"label\");\n    i0.ɵɵtext(2, \"Monto retenido\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(3, \"input\", 71);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(4);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.resolverMontoControl);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_68_div_5_div_18_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 72);\n    i0.ɵɵtext(1, \"Obligatoria si retienes total/parcial.\");\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_68_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r24 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"div\")(2, \"strong\");\n    i0.ɵɵtext(3, \"Resolver:\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(4, \"label\");\n    i0.ɵɵelement(5, \"input\", 64);\n    i0.ɵɵtext(6, \" Liberar dep\\u00F3sito \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(7, \"label\");\n    i0.ɵɵelement(8, \"input\", 65);\n    i0.ɵɵtext(9, \" Retener parcial \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"label\");\n    i0.ɵɵelement(11, \"input\", 66);\n    i0.ɵɵtext(12, \" Retener total \");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(13, RentaResumenComponent_ng_container_13_div_68_div_5_div_13_Template, 4, 1, \"div\", 67);\n    i0.ɵɵelementStart(14, \"div\", 68)(15, \"label\");\n    i0.ɵɵtext(16, \"Nota\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelement(17, \"textarea\", 69);\n    i0.ɵɵtemplate(18, RentaResumenComponent_ng_container_13_div_68_div_5_div_18_Template, 2, 0, \"div\", 70);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_68_div_5_Template_button_click_19_listener() {\n      i0.ɵɵrestoreView(_r24);\n      const ctx_r0 = i0.ɵɵnextContext(3);\n      return i0.ɵɵresetView(ctx_r0.resolverIncidente());\n    });\n    i0.ɵɵtext(20, \" Resolver incidente \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.resolverDecisionControl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.resolverDecisionControl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.resolverDecisionControl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.resolverDecisionControl.value === \"retener_parcial\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.resolverNotaControl);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.resolverDecisionControl.value !== \"liberar\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_68_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 49)(1, \"div\", 45);\n    i0.ɵɵtext(2, \"Incidente\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 11);\n    i0.ɵɵtext(4);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(5, RentaResumenComponent_ng_container_13_div_68_div_5_Template, 21, 7, \"div\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", (ctx_r0.renta.incidente == null ? null : ctx_r0.renta.incidente.descripcion) || \"Incidente reportado.\", \" \");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedoResolverIncidente);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_69_span_7_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"span\");\n    i0.ɵɵtext(1, \" \\u00B7 Retenido: \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0.formatMoney(ctx_r0.renta.incidente == null ? null : ctx_r0.renta.incidente.monto_retenido));\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_69_div_8_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11)(1, \"strong\");\n    i0.ɵɵtext(2, \"Nota:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.renta.incidente == null ? null : ctx_r0.renta.incidente.nota, \" \");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_69_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 49)(1, \"div\", 45);\n    i0.ɵɵtext(2, \"Incidente resuelto\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 11);\n    i0.ɵɵtext(4, \" Decisi\\u00F3n: \");\n    i0.ɵɵelementStart(5, \"strong\");\n    i0.ɵɵtext(6);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(7, RentaResumenComponent_ng_container_13_div_69_span_7_Template, 4, 1, \"span\", 10);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(8, RentaResumenComponent_ng_container_13_div_69_div_8_Template, 4, 1, \"div\", 7);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate(ctx_r0.incidenteDecisionLabel(ctx_r0.renta.incidente == null ? null : ctx_r0.renta.incidente.decision));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", (ctx_r0.renta.incidente == null ? null : ctx_r0.renta.incidente.monto_retenido) != null);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.renta.incidente == null ? null : ctx_r0.renta.incidente.nota);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_70_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r25 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 49)(1, \"div\", 45);\n    i0.ɵɵtext(2, \"Calificar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 73)(4, \"button\", 74);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_70_Template_button_click_4_listener() {\n      i0.ɵɵrestoreView(_r25);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.onSelectEstrellas(1));\n    });\n    i0.ɵɵtext(5, \"\\u2605\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"button\", 74);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_70_Template_button_click_6_listener() {\n      i0.ɵɵrestoreView(_r25);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.onSelectEstrellas(2));\n    });\n    i0.ɵɵtext(7, \"\\u2605\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(8, \"button\", 74);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_70_Template_button_click_8_listener() {\n      i0.ɵɵrestoreView(_r25);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.onSelectEstrellas(3));\n    });\n    i0.ɵɵtext(9, \"\\u2605\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"button\", 74);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_70_Template_button_click_10_listener() {\n      i0.ɵɵrestoreView(_r25);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.onSelectEstrellas(4));\n    });\n    i0.ɵɵtext(11, \"\\u2605\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(12, \"button\", 74);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_70_Template_button_click_12_listener() {\n      i0.ɵɵrestoreView(_r25);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.onSelectEstrellas(5));\n    });\n    i0.ɵɵtext(13, \"\\u2605\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelement(14, \"textarea\", 75);\n    i0.ɵɵelementStart(15, \"button\", 35);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_70_Template_button_click_15_listener() {\n      i0.ɵɵrestoreView(_r25);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.enviarCalificacion());\n    });\n    i0.ɵɵtext(16, \" Enviar calificaci\\u00F3n \");\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(4);\n    i0.ɵɵclassProp(\"active\", ctx_r0.estrellas >= 1);\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"active\", ctx_r0.estrellas >= 2);\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"active\", ctx_r0.estrellas >= 3);\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"active\", ctx_r0.estrellas >= 4);\n    i0.ɵɵadvance(2);\n    i0.ɵɵclassProp(\"active\", ctx_r0.estrellas >= 5);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"formControl\", ctx_r0.comentarioControl);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_71_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵtext(1, \" Ya calificaste esta renta: \");\n    i0.ɵɵelementStart(2, \"strong\");\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(4, \" / 5. \");\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(ctx_r0.miCalificacion.rating);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_72_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r26 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 76);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_72_Template_div_click_0_listener() {\n      i0.ɵɵrestoreView(_r26);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(!ctx_r0.paying && ctx_r0.cerrarPago());\n    });\n    i0.ɵɵelementEnd();\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_73_div_20_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 12);\n    i0.ɵɵtext(1);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(3);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate(ctx_r0.pagoError);\n  }\n}\nfunction RentaResumenComponent_ng_container_13_div_73_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r27 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 77)(1, \"div\", 78);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_73_Template_div_click_1_listener($event) {\n      i0.ɵɵrestoreView(_r27);\n      return i0.ɵɵresetView($event.stopPropagation());\n    });\n    i0.ɵɵelementStart(2, \"div\", 79)(3, \"h3\");\n    i0.ɵɵtext(4, \"Pagar\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(5, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_73_Template_button_click_5_listener() {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.cerrarPago());\n    });\n    i0.ɵɵtext(6, \"Cerrar\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(7, \"form\", 80);\n    i0.ɵɵlistener(\"ngSubmit\", function RentaResumenComponent_ng_container_13_div_73_Template_form_ngSubmit_7_listener() {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.confirmarPago());\n    });\n    i0.ɵɵelementStart(8, \"label\");\n    i0.ɵɵtext(9, \"N\\u00FAmero de tarjeta\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"input\", 81);\n    i0.ɵɵlistener(\"input\", function RentaResumenComponent_ng_container_13_div_73_Template_input_input_10_listener($event) {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.onTarjetaInput($event));\n    });\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(11, \"div\", 82)(12, \"div\")(13, \"label\");\n    i0.ɵɵtext(14, \"Vencimiento (MM/AA)\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"input\", 83);\n    i0.ɵɵlistener(\"input\", function RentaResumenComponent_ng_container_13_div_73_Template_input_input_15_listener($event) {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.onVencimientoInput($event));\n    });\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(16, \"div\")(17, \"label\");\n    i0.ɵɵtext(18, \"CVV\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(19, \"input\", 84);\n    i0.ɵɵlistener(\"input\", function RentaResumenComponent_ng_container_13_div_73_Template_input_input_19_listener($event) {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r0.onCvvInput($event));\n    });\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵtemplate(20, RentaResumenComponent_ng_container_13_div_73_div_20_Template, 2, 1, \"div\", 8);\n    i0.ɵɵelementStart(21, \"button\", 85);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_div_73_Template_button_click_21_listener($event) {\n      i0.ɵɵrestoreView(_r27);\n      const ctx_r0 = i0.ɵɵnextContext(2);\n      $event.preventDefault();\n      return i0.ɵɵresetView(ctx_r0.confirmarPago());\n    });\n    i0.ɵɵtext(22);\n    i0.ɵɵelementEnd()()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext(2);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"value\", ctx_r0.tarjetaFormateada);\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"value\", ctx_r0.vencimientoFormateado);\n    i0.ɵɵadvance(4);\n    i0.ɵɵproperty(\"value\", ctx_r0.cvvDigits);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.pagoError);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying || !ctx_r0.puedePagarModalUi);\n    i0.ɵɵadvance();\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.paying ? \"Procesando...\" : \"Pagar\", \" \");\n  }\n}\nfunction RentaResumenComponent_ng_container_13_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r2 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementContainerStart(0);\n    i0.ɵɵtemplate(1, RentaResumenComponent_ng_container_13_div_1_Template, 4, 0, \"div\", 7)(2, RentaResumenComponent_ng_container_13_div_2_Template, 4, 1, \"div\", 7);\n    i0.ɵɵelementStart(3, \"div\", 15)(4, \"div\", 16);\n    i0.ɵɵtext(5);\n    i0.ɵɵelementStart(6, \"span\", 17);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"div\", 18)(9, \"div\")(10, \"strong\");\n    i0.ɵɵtext(11, \"Inicio:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(12);\n    i0.ɵɵpipe(13, \"date\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(14, \"div\")(15, \"strong\");\n    i0.ɵɵtext(16, \"Fin:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(17);\n    i0.ɵɵpipe(18, \"date\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(19, \"div\", 19)(20, \"div\")(21, \"strong\");\n    i0.ɵɵtext(22, \"Total:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(23);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(24, \"div\", 20);\n    i0.ɵɵtext(25);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵelementStart(26, \"div\", 21);\n    i0.ɵɵtemplate(27, RentaResumenComponent_ng_container_13_button_27_Template, 2, 1, \"button\", 22);\n    i0.ɵɵelementStart(28, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_Template_button_click_28_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.volverExplorar());\n    });\n    i0.ɵɵtext(29, \" Volver \");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(30, \"details\", 24, 0)(32, \"summary\");\n    i0.ɵɵtext(33, \"Entrega y devoluci\\u00F3n\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(34, \"div\", 25)(35, \"div\", 11)(36, \"div\")(37, \"strong\");\n    i0.ɵɵtext(38, \"Estado actual:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(39);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(40, \"div\")(41, \"strong\");\n    i0.ɵɵtext(42, \"Siguiente paso:\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵtext(43);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(44, \"ul\", 26);\n    i0.ɵɵtemplate(45, RentaResumenComponent_ng_container_13_li_45_Template, 4, 4, \"li\", 27);\n    i0.ɵɵelementEnd();\n    i0.ɵɵtemplate(46, RentaResumenComponent_ng_container_13_div_46_Template, 2, 0, \"div\", 7)(47, RentaResumenComponent_ng_container_13_div_47_Template, 4, 3, \"div\", 10);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵtemplate(48, RentaResumenComponent_ng_container_13_div_48_Template, 12, 5, \"div\", 28)(49, RentaResumenComponent_ng_container_13_div_49_Template, 11, 2, \"div\", 29)(50, RentaResumenComponent_ng_container_13_div_50_Template, 5, 2, \"div\", 29)(51, RentaResumenComponent_ng_container_13_details_51_Template, 6, 1, \"details\", 30);\n    i0.ɵɵelementStart(52, \"details\", 24)(53, \"summary\");\n    i0.ɵɵtext(54, \"Otras acciones\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(55, \"div\", 25)(56, \"div\", 31);\n    i0.ɵɵtemplate(57, RentaResumenComponent_ng_container_13_button_57_Template, 3, 3, \"button\", 32)(58, RentaResumenComponent_ng_container_13_button_58_Template, 2, 2, \"button\", 32)(59, RentaResumenComponent_ng_container_13_button_59_Template, 2, 1, \"button\", 22)(60, RentaResumenComponent_ng_container_13_button_60_Template, 2, 1, \"button\", 22)(61, RentaResumenComponent_ng_container_13_button_61_Template, 2, 1, \"button\", 22)(62, RentaResumenComponent_ng_container_13_button_62_Template, 2, 1, \"button\", 22)(63, RentaResumenComponent_ng_container_13_button_63_Template, 2, 2, \"button\", 32);\n    i0.ɵɵelementStart(64, \"button\", 23);\n    i0.ɵɵlistener(\"click\", function RentaResumenComponent_ng_container_13_Template_button_click_64_listener() {\n      i0.ɵɵrestoreView(_r2);\n      const ctx_r0 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r0.irMisRentas());\n    });\n    i0.ɵɵtext(65, \" Ir a mis rentas \");\n    i0.ɵɵelementEnd()()()();\n    i0.ɵɵtemplate(66, RentaResumenComponent_ng_container_13_div_66_Template, 11, 3, \"div\", 29)(67, RentaResumenComponent_ng_container_13_div_67_Template, 6, 2, \"div\", 29)(68, RentaResumenComponent_ng_container_13_div_68_Template, 6, 2, \"div\", 29)(69, RentaResumenComponent_ng_container_13_div_69_Template, 9, 3, \"div\", 29)(70, RentaResumenComponent_ng_container_13_div_70_Template, 17, 12, \"div\", 29)(71, RentaResumenComponent_ng_container_13_div_71_Template, 5, 1, \"div\", 7)(72, RentaResumenComponent_ng_container_13_div_72_Template, 1, 0, \"div\", 33)(73, RentaResumenComponent_ng_container_13_div_73_Template, 23, 7, \"div\", 34);\n    i0.ɵɵelementContainerEnd();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.esExpirada);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.renta.reembolso_simulado);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate1(\" \", (ctx_r0.renta.articulo == null ? null : ctx_r0.renta.articulo.titulo) || \"Art\\u00EDculo\", \" \");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.estadoUi);\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(13, 35, ctx_r0.renta.fecha_inicio, \"medium\"), \"\");\n    i0.ɵɵadvance(5);\n    i0.ɵɵtextInterpolate1(\" \", i0.ɵɵpipeBind2(18, 38, ctx_r0.renta.fecha_fin, \"medium\"), \"\");\n    i0.ɵɵadvance(6);\n    i0.ɵɵtextInterpolate1(\" $\", ctx_r0.total, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(ctx_r0.depositoMensaje);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedePagarAhoraUi);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n    i0.ɵɵadvance(11);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.estadoUi, \"\");\n    i0.ɵɵadvance(4);\n    i0.ɵɵtextInterpolate1(\" \", ctx_r0.siguientePasoEntregaUi, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.flujoEntregaStepsUi);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.isPendientePago);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.coordinacionHabilitadaUi);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.chatVisible);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.soyArrendatario && (ctx_r0.renta.codigo_entrega || ctx_r0.renta.codigo_devolucion));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.soyDueno && (ctx_r0.puedeConfirmarEntregaOtp || ctx_r0.puedeConfirmarDevolucionOtp));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.timeline.length > 0);\n    i0.ɵɵadvance(6);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedeDescargarRecibo);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedeCancelar);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedeConfirmarEntregaUi);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedeMarcarEnUsoUi);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedeDevolverUi);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedeFinalizarUi);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.puedeReportarIncidenteUi);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"disabled\", ctx_r0.paying);\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showCancelar && ctx_r0.puedeCancelar);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.showIncidente);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.estadoNormalizado === \"incidente\");\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.estadoNormalizado === \"finalizada\" && (ctx_r0.renta.incidente == null ? null : ctx_r0.renta.incidente.decision));\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.estadoNormalizado === \"finalizada\" && (ctx_r0.soyArrendatario || ctx_r0.soyDueno) && ctx_r0.ratingSupported === true && !ctx_r0.miCalificacion);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.estadoNormalizado === \"finalizada\" && (ctx_r0.soyArrendatario || ctx_r0.soyDueno) && ctx_r0.miCalificacion);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.pagoOpen);\n    i0.ɵɵadvance();\n    i0.ɵɵproperty(\"ngIf\", ctx_r0.pagoOpen);\n  }\n}\nexport let RentaResumenComponent = /*#__PURE__*/(() => {\n  class RentaResumenComponent {\n    constructor(route, router, rentaService, authService, badgeService, puntoEntregaService) {\n      this.route = route;\n      this.router = router;\n      this.rentaService = rentaService;\n      this.authService = authService;\n      this.badgeService = badgeService;\n      this.puntoEntregaService = puntoEntregaService;\n      this.loading = false;\n      this.paying = false;\n      this.downloadingRecibo = false;\n      this.processingMessage = '';\n      this.errorMessage = '';\n      this.successMessage = '';\n      this.renta = null;\n      this.showIncidente = false;\n      this.incidenteControl = new FormControl('', [Validators.required, Validators.minLength(5)]);\n      this.showCancelar = false;\n      this.cancelarMotivoControl = new FormControl('', [Validators.maxLength(200)]);\n      this.ratingSupported = null;\n      this.showCalificar = false;\n      this.miCalificacion = null;\n      this.estrellas = 5;\n      this.comentarioControl = new FormControl('', [Validators.maxLength(200)]);\n      // Resolver incidente (dueño/admin)\n      this.resolverDecisionControl = new FormControl('liberar', [Validators.required]);\n      this.resolverMontoControl = new FormControl(null);\n      this.resolverNotaControl = new FormControl('', [Validators.maxLength(300)]);\n      this.toastMessage = '';\n      this.toastType = 'info';\n      this.toastTimer = null;\n      // Pago (UI simple)\n      this.pagoOpen = false;\n      this.pagoError = '';\n      // Guardamos SOLO dígitos en cada control.\n      this.tarjetaControl = new FormControl('', [Validators.required, Validators.minLength(16), Validators.maxLength(16)]);\n      this.vencimientoControl = new FormControl('', [Validators.required, Validators.minLength(4), Validators.maxLength(4)]); // MMYY\n      this.cvvControl = new FormControl('', [Validators.required, Validators.minLength(3), Validators.maxLength(3)]);\n      // Coordinación (UI simple por slots)\n      this.coordOpenAuto = false;\n      this.coordError = '';\n      this.coordSaving = false;\n      // Coordinación (v2): lugar + hora exacta\n      this.lugarEntregaControl = new FormControl('', [Validators.required, Validators.maxLength(80)]);\n      this.lugarDevolucionControl = new FormControl('', [Validators.required, Validators.maxLength(80)]);\n      this.horaEntregaControl = new FormControl('', [Validators.required]);\n      this.horaDevolucionControl = new FormControl('', [Validators.required]);\n      this.coordNowMs = Date.now();\n      this.coordTickTimer = null;\n      // OTP demo-local (arrendatario)\n      this.otpEntregaOpen = false;\n      this.otpDevolucionOpen = false;\n      this.otpEntregaArrControl = new FormControl('', [Validators.required, Validators.minLength(6), Validators.maxLength(6)]);\n      this.otpDevolucionArrControl = new FormControl('', [Validators.required, Validators.minLength(6), Validators.maxLength(6)]);\n      this.otpArrError = '';\n      // Coordinación (panel)\n      this.modoEntregaControl = new FormControl('arrendador', [Validators.required]);\n      this.entregaModoControl = new FormControl('domicilio', [Validators.required]);\n      this.puntoEntregaFiltroControl = new FormControl('', [Validators.maxLength(120)]);\n      this.puntoEntregaIdControl = new FormControl('', []);\n      this.puntosEntrega = [];\n      this.puntosEntregaLoading = false;\n      this.puntosEntregaError = '';\n      this.zonaPublicaControl = new FormControl('', [Validators.maxLength(120)]);\n      this.direccionEntregaControl = new FormControl('', [Validators.maxLength(300)]);\n      this.ventanasEntregaControl = new FormControl('', [Validators.maxLength(800)]);\n      this.ventanasDevolucionControl = new FormControl('', [Validators.maxLength(800)]);\n      this.ventanaEntregaElegidaControl = new FormControl('', [Validators.required]);\n      this.ventanaDevolucionElegidaControl = new FormControl('', [Validators.required]);\n      // Chat (polling)\n      this.chatMessages = [];\n      this.chatInputControl = new FormControl('', [Validators.required, Validators.maxLength(240)]);\n      this.chatSub = null;\n      this.shouldFocusChat = false;\n      // OTP (dueño valida)\n      this.otpEntregaControl = new FormControl('', [Validators.required, Validators.minLength(6), Validators.maxLength(6)]);\n      this.checklistEntregaControl = new FormControl('', [Validators.maxLength(800)]);\n      this.otpDevolucionControl = new FormControl('', [Validators.required, Validators.minLength(6), Validators.maxLength(6)]);\n      this.checklistDevolucionControl = new FormControl('', [Validators.maxLength(800)]);\n    }\n    ngOnInit() {\n      const id = Number(this.route.snapshot.paramMap.get('id'));\n      if (!Number.isFinite(id) || id <= 0) {\n        this.errorMessage = 'ID de renta inválido.';\n        return;\n      }\n      const q = this.route.snapshot.queryParamMap.get('chat');\n      const frag = this.route.snapshot.fragment;\n      this.shouldFocusChat = q === '1' || q === 'true' || frag === 'chat';\n      this.entregaModoControl.valueChanges.subscribe(v => {\n        if (v === 'punto_entrega') {\n          this.cargarPuntosEntregaSiHaceFalta();\n        }\n      });\n      this.cargarRenta(id);\n    }\n    ngOnDestroy() {\n      this.detenerChatPolling();\n      this.stopCoordTick();\n    }\n    get subtotal() {\n      const r = this.renta;\n      if (!r) return 0;\n      return (typeof r.subtotal_renta === 'number' ? r.subtotal_renta : r.precio_total_renta) || 0;\n    }\n    get deposito() {\n      const r = this.renta;\n      if (!r) return 0;\n      return (typeof r.monto_deposito === 'number' ? r.monto_deposito : 0) || 0;\n    }\n    get total() {\n      const r = this.renta;\n      if (!r) return 0;\n      return (typeof r.total_a_pagar === 'number' ? r.total_a_pagar : this.subtotal + this.deposito) || 0;\n    }\n    get depositoMensaje() {\n      if (!this.renta) return '';\n      if (this.estadoNormalizado === 'incidente') return 'Depósito en revisión ⏸️';\n      const decision = this.renta.incidente?.decision;\n      const retenido = this.renta.incidente?.monto_retenido;\n      if ((decision === 'retener_parcial' || decision === 'retener_total') && typeof retenido === 'number' && retenido > 0) {\n        return `Depósito retenido: $${retenido} ✅`;\n      }\n      if (this.renta.deposito_liberado) return 'Depósito liberado ✅';\n      if (this.deposito > 0) return 'Depósito en garantía';\n      return 'Sin depósito';\n    }\n    formatMoney(v) {\n      const n = typeof v === 'string' ? Number(v) : v;\n      if (typeof n !== 'number' || !Number.isFinite(n)) return '-';\n      return `$${Math.round(n) === n ? n : n.toFixed(2)}`;\n    }\n    incidenteDecisionLabel(v) {\n      const s = String(v ?? '').trim();\n      if (s === 'liberar') return 'Liberar depósito';\n      if (s === 'retener_parcial') return 'Retener parcial';\n      if (s === 'retener_total') return 'Retener total';\n      return s || '-';\n    }\n    get esExpirada() {\n      return !!this.renta && this.estadoNormalizado === 'expirada';\n    }\n    get esCancelada() {\n      return !!this.renta && this.estadoNormalizado === 'cancelada';\n    }\n    get estadoRaw() {\n      const r = this.renta;\n      // Preferimos `estado` si el backend lo envía; fallback a `estado_renta`.\n      return String(r?.estado ?? r?.estado_renta ?? '').trim();\n    }\n    get estadoNormalizado() {\n      const e = this.estadoRaw.toLowerCase().trim();\n      return e || '';\n    }\n    get isPendientePago() {\n      return this.estadoNormalizado === 'pendiente_pago';\n    }\n    get isPagada() {\n      return this.estadoNormalizado === 'pagada';\n    }\n    get estadoUi() {\n      const r = this.renta;\n      const id = this.renta?.id_renta ?? this.renta?.id;\n      const flow = typeof id === 'number' ? this.readFlowLocal(id) : null;\n      if (flow?.estado === 'devuelta') return 'devuelta';\n      if (flow?.estado === 'en_uso') return 'en_uso';\n      if (this.isPagada && this.coordinacionConfirmadaUi) return 'coordinacion_confirmada';\n      return String(r?.estado ?? r?.estado_renta ?? '').trim();\n    }\n    get estadoFlujoNormalizado() {\n      const e = String(this.estadoUi ?? '').toLowerCase().trim();\n      return e || '';\n    }\n    get puedeCancelar() {\n      if (!this.renta) return false;\n      const e = this.estadoNormalizado;\n      if (e === 'finalizada' || e === 'incidente' || e === 'en_uso' || e === 'devuelta' || e === 'cancelada' || e === 'expirada') return false;\n      if (this.soyArrendatario) return e === 'pendiente_pago' || e === 'pagada' || e === 'confirmada';\n      if (this.soyDueno) return e === 'pagada' || e === 'confirmada';\n      if (this.soyAdmin) return e === 'pendiente_pago' || e === 'pagada' || e === 'confirmada';\n      return false;\n    }\n    get uiBloqueada() {\n      const e = this.estadoNormalizado;\n      return this.paying || this.esExpirada || this.esCancelada || e === 'finalizada';\n    }\n    get chatVisible() {\n      const r = this.renta;\n      if (!r) return false;\n      const e = this.estadoNormalizado;\n      if (e === 'cancelada' || e === 'expirada' || e === 'finalizada') return false;\n      return r.chat_habilitado === true;\n    }\n    get ventanasEntregaOpciones() {\n      return (this.renta?.ventanas_entrega_propuestas ?? []).filter(v => !!v);\n    }\n    get ventanasDevolucionOpciones() {\n      return (this.renta?.ventanas_devolucion_propuestas ?? []).filter(v => !!v);\n    }\n    get puedeConfirmarCoordinacion() {\n      const r = this.renta;\n      if (!r) return false;\n      if (!this.soyDueno) return false;\n      if (this.uiBloqueada) return false;\n      const e = this.estadoNormalizado;\n      if (e === 'finalizada' || e === 'cancelada' || e === 'expirada') return false;\n      return !!r.ventana_entrega_elegida && !!r.ventana_devolucion_elegida && !r.coordinacion_confirmada;\n    }\n    get puedeEnviarChat() {\n      const r = this.renta;\n      if (!r) return false;\n      if (this.uiBloqueada) return false;\n      return r.chat_habilitado === true;\n    }\n    // Matriz exacta (UI)\n    get puedePagarAhoraUi() {\n      return this.soyArrendatario && this.isPendientePago && !this.esExpirada && !this.esCancelada;\n    }\n    get puedeConfirmarEntregaUi() {\n      return this.soyDueno && this.isPagada && !this.uiBloqueada;\n    }\n    get puedeMarcarEnUsoUi() {\n      return this.soyArrendatario && this.estadoNormalizado === 'confirmada' && !this.uiBloqueada;\n    }\n    get puedeDevolverUi() {\n      return this.soyArrendatario && this.estadoNormalizado === 'en_uso' && !this.uiBloqueada;\n    }\n    get puedeFinalizarUi() {\n      return this.soyDueno && this.estadoNormalizado === 'devuelta' && !this.uiBloqueada;\n    }\n    get puedeReportarIncidenteUi() {\n      // Según tabla: dueño puede opcionalmente reportar incidente en devuelta\n      return this.soyDueno && this.estadoNormalizado === 'devuelta' && !this.esExpirada && !this.esCancelada;\n    }\n    get puedeDescargarRecibo() {\n      const r = this.renta;\n      if (!r) return false;\n      return ['pagada', 'confirmada', 'en_uso', 'devuelta', 'finalizada', 'incidente'].includes(this.estadoNormalizado);\n    }\n    get puedeConfirmarEntregaOtp() {\n      const r = this.renta;\n      if (!r) return false;\n      if (!this.soyDueno) return false;\n      if (this.uiBloqueada) return false;\n      return this.isPagada || this.estadoNormalizado === 'confirmada';\n    }\n    get puedeConfirmarDevolucionOtp() {\n      const r = this.renta;\n      if (!r) return false;\n      if (!this.soyDueno) return false;\n      if (this.uiBloqueada) return false;\n      return this.estadoNormalizado === 'en_uso';\n    }\n    getFecha(key) {\n      const r = this.renta;\n      if (!r) return null;\n      const id = r.id_renta ?? r.id;\n      const localFlow = typeof id === 'number' ? this.readFlowLocal(id) : null;\n      const fromLocal = localFlow && localFlow[key] != null ? localFlow[key] : null;\n      if (fromLocal) return fromLocal;\n      const tl = r.timeline ?? null;\n      const v = tl && tl[key] != null ? tl[key] : r[key];\n      return v ?? null;\n    }\n    flowLsKey(idRenta) {\n      return `mr_flow_renta_v1:${idRenta}`;\n    }\n    readFlowLocal(idRenta) {\n      try {\n        const raw = localStorage.getItem(this.flowLsKey(idRenta));\n        if (!raw) return null;\n        const obj = JSON.parse(raw);\n        if (!obj || typeof obj !== 'object') return null;\n        const estado = String(obj.estado || '').trim();\n        if (!['coordinacion_confirmada', 'en_uso', 'devuelta'].includes(estado)) return null;\n        const out = {\n          estado\n        };\n        for (const k of ['fecha_coordinacion_confirmada', 'fecha_entrega_confirmada', 'fecha_en_uso', 'fecha_devolucion']) {\n          const v = String(obj[k] ?? '').trim();\n          if (v) out[k] = v;\n        }\n        return out;\n      } catch {\n        return null;\n      }\n    }\n    writeFlowLocal(idRenta, payload) {\n      try {\n        localStorage.setItem(this.flowLsKey(idRenta), JSON.stringify(payload));\n      } catch {\n        // ignore\n      }\n    }\n    clearFlowLocal(idRenta) {\n      try {\n        localStorage.removeItem(this.flowLsKey(idRenta));\n      } catch {\n        // ignore\n      }\n    }\n    coordLsKey(idRenta) {\n      return `mr_coord_renta_v1:${idRenta}`;\n    }\n    coordLsKeyV2(idRenta) {\n      return `mr_coord_renta_v2:${idRenta}`;\n    }\n    readCoordLocalV2(idRenta) {\n      try {\n        const raw = localStorage.getItem(this.coordLsKeyV2(idRenta));\n        if (!raw) return null;\n        const obj = JSON.parse(raw);\n        if (!obj || typeof obj !== 'object') return null;\n        const entregaLugar = String(obj.entregaLugar || '').trim();\n        const devolucionLugar = String(obj.devolucionLugar || '').trim();\n        const entregaHora = String(obj.entregaHora || '').trim();\n        const devolucionHora = String(obj.devolucionHora || '').trim();\n        const expiresAt = String(obj.expiresAt || '').trim();\n        const confirmedAt = String(obj.confirmedAt || '').trim();\n        if (!entregaLugar || !devolucionLugar || !entregaHora || !devolucionHora) return null;\n        const out = {\n          entregaLugar,\n          devolucionLugar,\n          entregaHora,\n          devolucionHora\n        };\n        if (expiresAt) out.expiresAt = expiresAt;\n        if (confirmedAt) out.confirmedAt = confirmedAt;\n        return out;\n      } catch {\n        return null;\n      }\n    }\n    writeCoordLocalV2(idRenta, payload) {\n      try {\n        localStorage.setItem(this.coordLsKeyV2(idRenta), JSON.stringify(payload));\n      } catch {\n        // ignore\n      }\n    }\n    clearCoordLocalV2(idRenta) {\n      try {\n        localStorage.removeItem(this.coordLsKeyV2(idRenta));\n      } catch {\n        // ignore\n      }\n    }\n    get horasFijasUi() {\n      return ['09:00', '12:00', '15:00', '18:00', '20:00'];\n    }\n    startCoordTick() {\n      if (this.coordTickTimer) return;\n      this.coordTickTimer = setInterval(() => {\n        this.coordNowMs = Date.now();\n      }, 1000);\n    }\n    stopCoordTick() {\n      if (!this.coordTickTimer) return;\n      clearInterval(this.coordTickTimer);\n      this.coordTickTimer = null;\n    }\n    ensureCoordDraftTimer(idRenta) {\n      if (!this.isPagada) return;\n      if (this.coordinacionConfirmadaUi) {\n        this.stopCoordTick();\n        return;\n      }\n      const existing = this.readCoordLocalV2(idRenta);\n      if (existing?.confirmedAt) {\n        this.stopCoordTick();\n        return;\n      }\n      const expiresAt = existing?.expiresAt;\n      if (!expiresAt) {\n        const exp = new Date(Date.now() + 15 * 60 * 1000).toISOString();\n        this.writeCoordLocalV2(idRenta, {\n          entregaLugar: existing?.entregaLugar ?? (this.lugarEntregaControl.value ?? '').toString().trim(),\n          devolucionLugar: existing?.devolucionLugar ?? (this.lugarDevolucionControl.value ?? '').toString().trim(),\n          entregaHora: existing?.entregaHora ?? (this.horaEntregaControl.value ?? '').toString().trim(),\n          devolucionHora: existing?.devolucionHora ?? (this.horaDevolucionControl.value ?? '').toString().trim(),\n          expiresAt: exp\n        });\n      }\n      this.startCoordTick();\n    }\n    get coordExpiradaUi() {\n      const r = this.renta;\n      if (!r) return false;\n      if (!this.isPagada) return false;\n      if (this.coordinacionConfirmadaUi) return false;\n      const id = r.id_renta ?? r.id;\n      const v2 = this.readCoordLocalV2(id);\n      const expiresAt = v2?.expiresAt;\n      if (!expiresAt) return false;\n      const expMs = Date.parse(expiresAt);\n      if (!Number.isFinite(expMs)) return false;\n      return this.coordNowMs >= expMs;\n    }\n    get coordTiempoRestanteUi() {\n      const r = this.renta;\n      if (!r) return '';\n      const id = r.id_renta ?? r.id;\n      const v2 = this.readCoordLocalV2(id);\n      const expiresAt = v2?.expiresAt;\n      if (!expiresAt) return '';\n      const expMs = Date.parse(expiresAt);\n      if (!Number.isFinite(expMs)) return '';\n      const ms = Math.max(0, expMs - this.coordNowMs);\n      const totalSec = Math.floor(ms / 1000);\n      const min = Math.floor(totalSec / 60);\n      const sec = totalSec % 60;\n      return `${min}:${String(sec).padStart(2, '0')}`;\n    }\n    readCoordLocal(idRenta) {\n      try {\n        const raw = localStorage.getItem(this.coordLsKey(idRenta));\n        if (!raw) return null;\n        const obj = JSON.parse(raw);\n        if (!obj || typeof obj !== 'object') return null;\n        const entregaLabel = String(obj.entregaLabel || '').trim();\n        const devolucionLabel = String(obj.devolucionLabel || '').trim();\n        const entregaValue = String(obj.entregaValue || '').trim();\n        const devolucionValue = String(obj.devolucionValue || '').trim();\n        const confirmedAt = String(obj.confirmedAt || '').trim();\n        if (!entregaLabel || !devolucionLabel || !entregaValue || !devolucionValue || !confirmedAt) return null;\n        if (!['Mañana', 'Tarde', 'Noche'].includes(entregaLabel)) return null;\n        if (!['Mañana', 'Tarde', 'Noche'].includes(devolucionLabel)) return null;\n        return {\n          entregaLabel,\n          devolucionLabel,\n          entregaValue,\n          devolucionValue,\n          confirmedAt\n        };\n      } catch {\n        return null;\n      }\n    }\n    writeCoordLocal(idRenta, payload) {\n      try {\n        localStorage.setItem(this.coordLsKey(idRenta), JSON.stringify(payload));\n      } catch {\n        // ignore\n      }\n    }\n    get coordinacionHabilitadaUi() {\n      const r = this.renta;\n      if (!r) return false;\n      if (this.uiBloqueada) return false;\n      // Habilitar coordinación solo cuando está pagada.\n      // Si ya quedó confirmada, mantenemos la sección visible.\n      return this.isPagada || this.coordinacionConfirmadaUi;\n    }\n    get coordinacionConfirmadaUi() {\n      const r = this.renta;\n      if (!r) return false;\n      const id = r.id_renta ?? r.id;\n      const v2 = this.readCoordLocalV2(id);\n      const local = this.readCoordLocal(id);\n      return !!this.getFecha('fecha_coordinacion_confirmada') || !!r.coordinacion_confirmada || !!v2?.confirmedAt || !!local?.confirmedAt;\n    }\n    get ventanaEntregaUi() {\n      const r = this.renta;\n      if (!r) return null;\n      if (r.ventana_entrega_elegida) return r.ventana_entrega_elegida;\n      const id = r.id_renta ?? r.id;\n      const v2 = this.readCoordLocalV2(id);\n      if (v2?.entregaLugar && v2?.entregaHora) return `${v2.entregaLugar} · ${v2.entregaHora}`;\n      const local = this.readCoordLocal(id);\n      return local?.entregaLabel ?? null;\n    }\n    get ventanaDevolucionUi() {\n      const r = this.renta;\n      if (!r) return null;\n      if (r.ventana_devolucion_elegida) return r.ventana_devolucion_elegida;\n      const id = r.id_renta ?? r.id;\n      const v2 = this.readCoordLocalV2(id);\n      if (v2?.devolucionLugar && v2?.devolucionHora) return `${v2.devolucionLugar} · ${v2.devolucionHora}`;\n      const local = this.readCoordLocal(id);\n      return local?.devolucionLabel ?? null;\n    }\n    get entregaSlotOptions() {\n      const propuestas = (this.renta?.ventanas_entrega_propuestas ?? []).filter(x => !!x);\n      const labels = ['Mañana', 'Tarde', 'Noche'];\n      if (propuestas.length >= 2) {\n        return labels.slice(0, Math.min(3, propuestas.length)).map((label, i) => ({\n          label,\n          value: String(propuestas[i])\n        }));\n      }\n      return labels.map(label => ({\n        label,\n        value: label\n      }));\n    }\n    get devolucionSlotOptions() {\n      const propuestas = (this.renta?.ventanas_devolucion_propuestas ?? []).filter(x => !!x);\n      const labels = ['Mañana', 'Tarde', 'Noche'];\n      if (propuestas.length >= 2) {\n        return labels.slice(0, Math.min(3, propuestas.length)).map((label, i) => ({\n          label,\n          value: String(propuestas[i])\n        }));\n      }\n      return labels.map(label => ({\n        label,\n        value: label\n      }));\n    }\n    get siguientePasoEntregaUi() {\n      const r = this.renta;\n      if (!r) return '';\n      if (this.isPendientePago) return 'Paga para habilitar coordinación.';\n      if (this.isPagada && !this.coordinacionConfirmadaUi) return 'Elige lugar y hora exacta para coordinación.';\n      if (this.isPagada && this.coordinacionConfirmadaUi && !this.getFecha('fecha_en_uso')) return 'Entrega pendiente (OTP de entrega requerido).';\n      if (!this.coordinacionConfirmadaUi) return 'Elige ventanas y confirma coordinación.';\n      if (!this.getFecha('fecha_entrega_confirmada') && !r.fecha_entrega) return 'Entrega pendiente.';\n      if (!this.getFecha('fecha_en_uso')) return 'Marcar en uso (cuando corresponda).';\n      if (!this.getFecha('fecha_devolucion') && !r.fecha_devolucion) return 'Devolución pendiente.';\n      return 'Flujo en curso.';\n    }\n    get flujoEntregaStepsUi() {\n      const byKey = k => this.timeline.find(x => x.key === k)?.done ?? false;\n      const pagada = byKey('pagada');\n      const coordDone = this.coordinacionConfirmadaUi;\n      const entregaDone = byKey('confirmada');\n      const enUsoDone = byKey('en_uso');\n      const devueltaDone = byKey('devuelta');\n      return [{\n        label: 'Pagada',\n        done: pagada\n      }, {\n        label: coordDone ? 'Coordinación confirmada' : 'Coordinación pendiente (elige ventana)',\n        done: coordDone\n      }, {\n        label: 'Entrega confirmada',\n        done: entregaDone\n      }, {\n        label: 'En uso',\n        done: enUsoDone\n      }, {\n        label: 'Devuelta',\n        done: devueltaDone\n      }];\n    }\n    get timeline() {\n      const r = this.renta;\n      if (!r) return [];\n      const estado = this.estadoFlujoNormalizado;\n      const order = {\n        pendiente_pago: 0,\n        pagada: 1,\n        coordinacion_confirmada: 2,\n        confirmada: 3,\n        en_uso: 4,\n        devuelta: 5,\n        finalizada: 6\n      };\n      const current = order[estado] ?? 0;\n      const fechaPago = this.getFecha('fecha_pago');\n      const id = r.id_renta ?? r.id;\n      const localCoord = this.readCoordLocal(id);\n      const fechaCoord = this.getFecha('fecha_coordinacion_confirmada') || localCoord?.confirmedAt || null;\n      const fechaEntrega = this.getFecha('fecha_entrega_confirmada') || (r.fecha_entrega ?? null);\n      const fechaEnUso = this.getFecha('fecha_en_uso');\n      const fechaDev = this.getFecha('fecha_devolucion') || (r.fecha_devolucion ?? null);\n      const fechaFin = this.getFecha('fecha_finalizacion') || this.getFecha('fecha_liberacion_deposito');\n      const fechaInc = this.getFecha('fecha_incidente');\n      const fechaCanc = this.getFecha('fecha_cancelacion');\n      const fechaExp = this.getFecha('fecha_expiracion');\n      const items = [];\n      items.push({\n        key: 'pagada',\n        label: 'Pagada',\n        date: fechaPago,\n        done: !!fechaPago || current >= order['pagada']\n      });\n      items.push({\n        key: 'coordinacion',\n        label: 'Coordinación confirmada',\n        date: fechaCoord,\n        done: !!fechaCoord || !!r.coordinacion_confirmada || current >= order['coordinacion_confirmada']\n      });\n      items.push({\n        key: 'confirmada',\n        label: 'Entrega confirmada',\n        date: fechaEntrega,\n        done: !!fechaEntrega || current >= order['confirmada']\n      });\n      items.push({\n        key: 'en_uso',\n        label: 'En uso',\n        date: fechaEnUso,\n        done: !!fechaEnUso || current >= order['en_uso']\n      });\n      items.push({\n        key: 'devuelta',\n        label: 'Devuelta',\n        date: fechaDev,\n        done: !!fechaDev || current >= order['devuelta']\n      });\n      if (estado === 'finalizada') {\n        items.push({\n          key: 'finalizada',\n          label: 'Finalizada',\n          date: fechaFin,\n          done: true\n        });\n        if (r.deposito_liberado === true) {\n          items.push({\n            key: 'deposito_liberado',\n            label: 'Depósito liberado ✅',\n            date: fechaFin,\n            done: true\n          });\n        }\n      }\n      if (estado === 'incidente' || !!fechaInc) {\n        items.push({\n          key: 'incidente',\n          label: 'Incidente',\n          date: fechaInc,\n          done: true\n        });\n      }\n      if (estado === 'cancelada') {\n        items.push({\n          key: 'cancelada',\n          label: 'Cancelada',\n          date: fechaCanc,\n          done: true\n        });\n        if (r.reembolso_simulado === true) {\n          items.push({\n            key: 'reembolso',\n            label: 'Reembolso simulado',\n            date: null,\n            done: true\n          });\n        }\n      }\n      if (estado === 'expirada') {\n        items.push({\n          key: 'expirada',\n          label: 'Expirada',\n          date: fechaExp,\n          done: true\n        });\n        if (r.reembolso_simulado === true) {\n          items.push({\n            key: 'reembolso',\n            label: 'Reembolso simulado',\n            date: null,\n            done: true\n          });\n        }\n      }\n      return items;\n    }\n    get userId() {\n      return this.authService.getUserId();\n    }\n    get soyDueno() {\n      const uid = this.userId;\n      return !!uid && !!this.renta && Number(this.renta.id_propietario) === uid;\n    }\n    get soyArrendatario() {\n      const uid = this.userId;\n      return !!uid && !!this.renta && Number(this.renta.id_arrendatario) === uid;\n    }\n    get soyAdmin() {\n      const roles = this.authService.getRoles();\n      return roles.some(r => {\n        const v = String(r).toUpperCase();\n        return v === 'ADMIN' || v === 'ADMINISTRADOR';\n      });\n    }\n    get esEntregaEnPuntoSeguro() {\n      return (this.entregaModoControl.value ?? 'domicilio') === 'punto_entrega';\n    }\n    get puntosEntregaFiltrados() {\n      const q = (this.puntoEntregaFiltroControl.value ?? '').toString().trim().toLowerCase();\n      const items = this.puntosEntrega ?? [];\n      if (!q) return items;\n      return items.filter(p => {\n        const nombre = (p.nombre ?? '').toString().toLowerCase();\n        const dir = (p.direccion ?? '').toString().toLowerCase();\n        return nombre.includes(q) || dir.includes(q);\n      });\n    }\n    get puedoResolverIncidente() {\n      return !!this.renta && this.renta.estado_renta === 'incidente' && (this.soyDueno || this.soyAdmin);\n    }\n    toggleIncidente() {\n      if (!this.renta) return;\n      if (!this.puedeReportarIncidenteUi) return;\n      if (this.paying) return;\n      this.showIncidente = !this.showIncidente;\n      this.errorMessage = '';\n      this.successMessage = '';\n      if (!this.showIncidente) {\n        this.incidenteControl.reset('');\n      }\n    }\n    toggleCancelar() {\n      if (!this.renta) return;\n      if (!this.puedeCancelar) return;\n      this.showCancelar = !this.showCancelar;\n      this.errorMessage = '';\n      this.successMessage = '';\n      if (!this.showCancelar) {\n        this.cancelarMotivoControl.reset('');\n      }\n    }\n    confirmarCancelar() {\n      if (!this.renta) return;\n      if (!this.puedeCancelar) return;\n      const motivo = (this.cancelarMotivoControl.value ?? '').toString().trim();\n      if (this.soyDueno && !motivo) {\n        this.showToast('error', 'El motivo es obligatorio para el dueño.');\n        return;\n      }\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.runAction('Cancelando renta...', () => this.rentaService.cancelar(id, motivo || null), id, 'Renta cancelada.');\n      this.showCancelar = false;\n      this.cancelarMotivoControl.reset('');\n    }\n    onSelectEstrellas(n) {\n      const v = Math.max(1, Math.min(5, Number(n)));\n      this.estrellas = v;\n    }\n    toggleCalificar() {\n      if (!this.renta) return;\n      if (this.renta.estado_renta !== 'finalizada') return;\n      if (!(this.soyArrendatario || this.soyDueno)) return;\n      if (this.ratingSupported !== true) return;\n      if (this.miCalificacion) return;\n      this.showCalificar = !this.showCalificar;\n      this.errorMessage = '';\n      this.successMessage = '';\n    }\n    enviarCalificacion() {\n      if (!this.renta) return;\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.runAction('Enviando calificación...', () => this.rentaService.calificar(id, {\n        estrellas: this.estrellas,\n        comentario: (this.comentarioControl.value ?? '').toString().trim() || null\n      }), id, 'Calificación enviada.');\n      this.showCalificar = false;\n      this.comentarioControl.reset('');\n    }\n    resolverIncidente() {\n      if (!this.renta) return;\n      if (!this.puedoResolverIncidente) return;\n      const id = this.renta.id_renta ?? this.renta.id;\n      const decision = this.resolverDecisionControl.value || 'liberar';\n      const montoRaw = this.resolverMontoControl.value;\n      const monto = typeof montoRaw === 'number' && Number.isFinite(montoRaw) ? montoRaw : null;\n      const nota = (this.resolverNotaControl.value ?? '').toString().trim() || null;\n      if (decision === 'retener_parcial') {\n        if (monto === null || monto <= 0) {\n          this.showToast('error', 'Indica un monto retenido válido (mayor a 0).');\n          return;\n        }\n        const dep = this.deposito;\n        if (dep > 0 && !(monto < dep)) {\n          this.showToast('error', 'El monto retenido debe ser menor al depósito.');\n          return;\n        }\n      }\n      if ((decision === 'retener_parcial' || decision === 'retener_total') && !nota) {\n        this.showToast('error', 'La nota es obligatoria cuando se retiene el depósito.');\n        return;\n      }\n      this.runAction('Resolviendo incidente...', () => this.rentaService.resolverIncidente(id, {\n        decision,\n        monto_retenido: monto,\n        nota\n      }), id, 'Incidente resuelto. Renta finalizada.');\n    }\n    volverExplorar() {\n      this.router.navigate(['/explorar']);\n    }\n    irMisRentas() {\n      this.router.navigate(['/rentas/mis']);\n    }\n    abrirPago() {\n      if (!this.puedePagarAhoraUi) return;\n      this.pagoError = '';\n      this.tarjetaControl.setValue('');\n      this.vencimientoControl.setValue('');\n      this.cvvControl.setValue('');\n      this.pagoOpen = true;\n    }\n    digitsOnly(raw) {\n      return String(raw ?? '').replace(/\\D+/g, '');\n    }\n    get tarjetaDigits() {\n      return this.digitsOnly(this.tarjetaControl.value).slice(0, 16);\n    }\n    get tarjetaFormateada() {\n      const d = this.tarjetaDigits;\n      return d.replace(/(\\d{4})(?=\\d)/g, '$1 ');\n    }\n    get vencimientoDigits() {\n      return this.digitsOnly(this.vencimientoControl.value).slice(0, 4);\n    }\n    get vencimientoFormateado() {\n      const d = this.vencimientoDigits;\n      if (d.length <= 2) return d;\n      return `${d.slice(0, 2)}/${d.slice(2, 4)}`;\n    }\n    get cvvDigits() {\n      return this.digitsOnly(this.cvvControl.value).slice(0, 3);\n    }\n    get mesVencimientoOk() {\n      const d = this.vencimientoDigits;\n      if (d.length !== 4) return false;\n      const mm = Number(d.slice(0, 2));\n      return Number.isFinite(mm) && mm >= 1 && mm <= 12;\n    }\n    get puedePagarModalUi() {\n      if (!this.puedePagarAhoraUi) return false;\n      return this.tarjetaDigits.length === 16 && this.vencimientoDigits.length === 4 && this.mesVencimientoOk && this.cvvDigits.length === 3;\n    }\n    onTarjetaInput(ev) {\n      const el = ev.target;\n      const digits = this.digitsOnly(el?.value).slice(0, 16);\n      this.tarjetaControl.setValue(digits, {\n        emitEvent: false\n      });\n      if (el) el.value = digits.replace(/(\\d{4})(?=\\d)/g, '$1 ');\n      this.pagoError = '';\n    }\n    onVencimientoInput(ev) {\n      const el = ev.target;\n      const digits = this.digitsOnly(el?.value).slice(0, 4);\n      this.vencimientoControl.setValue(digits, {\n        emitEvent: false\n      });\n      if (el) {\n        el.value = digits.length <= 2 ? digits : `${digits.slice(0, 2)}/${digits.slice(2, 4)}`;\n      }\n      this.pagoError = '';\n    }\n    onCvvInput(ev) {\n      const el = ev.target;\n      const digits = this.digitsOnly(el?.value).slice(0, 3);\n      this.cvvControl.setValue(digits, {\n        emitEvent: false\n      });\n      if (el) el.value = digits;\n      this.pagoError = '';\n    }\n    cerrarPago() {\n      this.pagoOpen = false;\n      this.pagoError = '';\n    }\n    confirmarPago() {\n      var _this = this;\n      const idRentaMaybe = this.renta?.id_renta ?? this.renta?.id;\n      console.log('PAGAR_CLICK', idRentaMaybe);\n      if (!this.renta) {\n        console.warn('PAGAR_ABORT: renta null');\n        return;\n      }\n      this.pagoError = '';\n      const card = this.tarjetaDigits;\n      const exp = this.vencimientoDigits; // MMYY\n      const cvv = this.cvvDigits;\n      if (card.length !== 16 || exp.length !== 4 || cvv.length !== 3) {\n        this.pagoError = 'Completa tarjeta (16), vencimiento (MMYY) y CVV (3).';\n        return;\n      }\n      if (!this.mesVencimientoOk) {\n        this.pagoError = 'Vencimiento inválido (mes 01–12).';\n        return;\n      }\n      // Pago real (simulado en UI): no enviamos datos sensibles al backend.\n      if (typeof idRentaMaybe !== 'number' || !Number.isFinite(idRentaMaybe) || idRentaMaybe <= 0) {\n        this.pagoError = 'ID de renta inválido.';\n        console.warn('PAGAR_ABORT: id inválido', idRentaMaybe);\n        return;\n      }\n      const id = idRentaMaybe;\n      if (this.paying) return;\n      console.log('PAGAR_PRECHECK', {\n        id,\n        estado: this.estadoUi,\n        estadoNormalizado: this.estadoNormalizado,\n        puedePagarAhoraUi: this.puedePagarAhoraUi,\n        puedePagarModalUi: this.puedePagarModalUi,\n        hasToken: !!this.authService.getToken()\n      });\n      this.errorMessage = '';\n      this.successMessage = '';\n      this.paying = true;\n      this.processingMessage = 'Procesando pago...';\n      console.log('PAGAR_HTTP_START', id);\n      _asyncToGenerator(function* () {\n        try {\n          const paid = yield firstValueFrom(_this.rentaService.pagarRenta(id));\n          console.log('PAGAR_HTTP_OK', {\n            id,\n            estado: paid?.estado ?? paid?.estado_renta ?? null\n          });\n          // Aplicar inmediatamente lo devuelto por el endpoint.\n          _this.aplicarRenta(paid, id);\n          // Refrescar para asegurar consistencia (estado/timeline/etc).\n          yield _this.recargarRentaAsync(id);\n          _this.pagoOpen = false;\n          const msg = '✅ Pago exitoso. La renta quedó como pagada.';\n          _this.successMessage = msg;\n          _this.showToast('success', msg);\n          _this.badgeService.refreshOnce();\n          // UX: habilitar coordinación y llevar al panel.\n          _this.coordError = '';\n          _this.coordEntregaLabel = null;\n          _this.coordDevolucionLabel = null;\n          _this.tryOpenEntregaAccordion();\n        } catch (err) {\n          const status = err?.status;\n          console.error('PAGAR_HTTP_ERR', {\n            id,\n            status,\n            err\n          });\n          const hasToken = !!_this.authService.getToken();\n          if ((status === 401 || status === 422) && !hasToken) {\n            _this.router.navigate(['/login']);\n            return;\n          }\n          if (status === 401 || status === 422) {\n            _this.pagoError = 'Sesión inválida o expirada. Vuelve a iniciar sesión.';\n            return;\n          }\n          if (status === 404) {\n            _this.pagoError = 'Endpoint de pago no encontrado (404): POST /rentas/{id}/pagar.';\n            return;\n          }\n          if (status === 409) {\n            // Si ya cambió de estado, recargamos y, si ya quedó pagada, cerramos modal.\n            _this.showToast('info', 'La renta ya cambió de estado, se recargará.');\n            try {\n              yield _this.recargarRentaAsync(id);\n              _this.badgeService.refreshOnce();\n              if (_this.estadoNormalizado !== 'pendiente_pago') {\n                _this.pagoOpen = false;\n                _this.tryOpenEntregaAccordion();\n              }\n            } catch {\n              // best-effort\n            }\n            return;\n          }\n          if (status === 403) {\n            _this.pagoError = 'No tienes permiso para pagar esta renta.';\n            return;\n          }\n          _this.pagoError = (err?.error?.message || 'No se pudo completar el pago.') + (status ? ` (HTTP ${status})` : '');\n        } finally {\n          _this.paying = false;\n          _this.processingMessage = '';\n        }\n      })();\n    }\n    pagarAhora() {\n      var _this2 = this;\n      if (!this.renta) return;\n      if (this.renta.estado_renta !== 'pendiente_pago') return;\n      if (this.esExpirada || this.esCancelada) return;\n      if (!this.soyArrendatario) return;\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.runAction('Procesando pago...', () => this.rentaService.pagarRenta(id).pipe(tap(r => this.aplicarRenta(r, id))), id, '✅ Pago exitoso. La renta quedó como pagada.', /*#__PURE__*/_asyncToGenerator(function* () {\n        // UX: habilitar coordinación y llevar al panel sin recargar la página.\n        _this2.coordError = '';\n        _this2.coordEntregaLabel = null;\n        _this2.coordDevolucionLabel = null;\n        _this2.tryOpenEntregaAccordion();\n      }));\n    }\n    descargarRecibo() {\n      if (!this.renta) return;\n      if (!this.puedeDescargarRecibo) return;\n      if (this.downloadingRecibo) return;\n      const id = this.renta.id_renta ?? this.renta.id;\n      if (!Number.isFinite(id) || id <= 0) return;\n      this.downloadingRecibo = true;\n      this.rentaService.descargarRecibo(id).subscribe({\n        next: blob => {\n          try {\n            const url = window.URL.createObjectURL(blob);\n            const a = document.createElement('a');\n            a.href = url;\n            a.download = `recibo-renta-${id}.pdf`;\n            document.body.appendChild(a);\n            a.click();\n            a.remove();\n            setTimeout(() => window.URL.revokeObjectURL(url), 1000);\n          } catch {\n            this.showToast('error', 'No se pudo descargar el recibo.');\n          } finally {\n            this.downloadingRecibo = false;\n          }\n        },\n        error: err => {\n          this.downloadingRecibo = false;\n          const status = err?.status;\n          const hasToken = !!this.authService.getToken();\n          if ((status === 401 || status === 422) && !hasToken) {\n            this.router.navigate(['/login']);\n            return;\n          }\n          this.showToast('error', err?.error?.message || 'No se pudo descargar el recibo.');\n        }\n      });\n    }\n    confirmarEntrega() {\n      if (!this.renta) return;\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.runAction('Confirmando entrega...', () => this.rentaService.confirmar(id), id, 'Entrega confirmada.');\n    }\n    marcarEnUso() {\n      if (!this.renta) return;\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.runAction('Marcando en uso...', () => this.rentaService.enUso(id), id, 'Renta marcada en uso.');\n    }\n    devolver() {\n      if (!this.renta) return;\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.runAction('Registrando devolución...', () => this.rentaService.devolver(id), id, 'Devolución registrada.');\n    }\n    finalizar() {\n      if (!this.renta) return;\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.runAction('Finalizando (liberando depósito)...', () => this.rentaService.finalizar(id), id, 'Renta finalizada. Depósito liberado.');\n    }\n    enviarIncidente() {\n      if (!this.renta) return;\n      if (this.renta.estado_renta === 'finalizada') return;\n      this.errorMessage = '';\n      this.successMessage = '';\n      if (this.incidenteControl.invalid) {\n        this.incidenteControl.markAsTouched();\n        this.errorMessage = 'Describe el incidente (mín. 5 caracteres).';\n        return;\n      }\n      const id = this.renta.id_renta ?? this.renta.id;\n      const descripcion = String(this.incidenteControl.value ?? '').trim();\n      this.runAction('Enviando incidente...', () => this.rentaService.incidente(id, descripcion), id, 'Incidente reportado.');\n      this.showIncidente = false;\n      this.incidenteControl.reset('');\n    }\n    cargarRenta(id) {\n      this.loading = true;\n      this.errorMessage = '';\n      this.successMessage = '';\n      this.rentaService.obtenerRenta(id).subscribe({\n        next: r => {\n          this.aplicarRenta(r, id);\n          this.loading = false;\n        },\n        error: err => {\n          this.loading = false;\n          const status = err?.status;\n          const hasToken = !!this.authService.getToken();\n          if ((status === 401 || status === 422) && !hasToken) {\n            this.router.navigate(['/login']);\n            return;\n          }\n          this.errorMessage = err?.error?.message || 'No se pudo cargar el resumen de la renta.';\n          this.showToast('error', this.errorMessage);\n        }\n      });\n    }\n    refrescar(id) {\n      this.rentaService.obtenerRenta(id).subscribe({\n        next: r => {\n          this.aplicarRenta(r, id);\n        },\n        error: () => {\n          // no rompe UX si el refresh falla\n        }\n      });\n    }\n    aplicarRenta(r, id) {\n      // Fix UX: si el backend ya marcó pago por fecha/timeline pero el estado aún llega como pendiente_pago,\n      // normalizamos a 'pagada' para evitar que el usuario pueda volver a pagar en UI.\n      const rr = {\n        ...r\n      };\n      const estado = String(rr.estado ?? rr.estado_renta ?? '').toLowerCase().trim();\n      const tl = rr.timeline ?? null;\n      const fechaPago = (tl ? tl['fecha_pago'] : null) ?? rr.fecha_pago;\n      if ((estado === 'pendiente_pago' || !estado) && !!fechaPago) {\n        rr.estado = 'pagada';\n        rr.estado_renta = 'pagada';\n      }\n      this.renta = rr;\n      this.sincronizarFormulariosConRenta();\n      this.ensureCoordDraftTimer(id);\n      this.iniciarChatPollingSiCorresponde(id);\n      this.marcarChatLeidoSiCorresponde(id);\n      this.scrollASiCorresponde();\n      // Cerrar paneles si ya no aplican\n      if (!this.puedeCancelar) this.showCancelar = false;\n      if (!this.puedeReportarIncidenteUi) this.showIncidente = false;\n      // Calificaciones (solo si aplica)\n      if (this.renta.estado_renta === 'finalizada' && (this.soyArrendatario || this.soyDueno)) {\n        this.cargarMiCalificacion(id);\n      } else {\n        this.ratingSupported = null;\n        this.showCalificar = false;\n        this.miCalificacion = null;\n      }\n    }\n    recargarRentaAsync(idRenta) {\n      var _this3 = this;\n      return _asyncToGenerator(function* () {\n        const r = yield firstValueFrom(_this3.rentaService.obtenerRenta(idRenta));\n        _this3.aplicarRenta(r, idRenta);\n      })();\n    }\n    runAction(actionName, httpCall, idRenta, successMsg, onSuccess) {\n      var _this4 = this;\n      if (this.paying) return;\n      this.errorMessage = '';\n      this.successMessage = '';\n      this.paying = true;\n      this.processingMessage = actionName;\n      _asyncToGenerator(function* () {\n        try {\n          yield firstValueFrom(httpCall());\n          yield _this4.recargarRentaAsync(idRenta);\n          if (onSuccess) {\n            yield onSuccess();\n          }\n          _this4.successMessage = successMsg;\n          _this4.showToast('success', successMsg || 'Listo.');\n          _this4.badgeService.refreshOnce();\n        } catch (err) {\n          const status = err?.status;\n          const hasToken = !!_this4.authService.getToken();\n          if ((status === 401 || status === 422) && !hasToken) {\n            _this4.router.navigate(['/login']);\n            return;\n          }\n          if (status === 409) {\n            _this4.showToast('info', 'La renta ya cambió de estado, se recargará.');\n            try {\n              yield _this4.recargarRentaAsync(idRenta);\n              _this4.badgeService.refreshOnce();\n            } catch {\n              // best-effort\n            }\n            return;\n          }\n          if (status === 403) {\n            _this4.errorMessage = 'No tienes permiso para realizar esta acción.';\n            _this4.showToast('error', _this4.errorMessage);\n            return;\n          }\n          _this4.errorMessage = err?.error?.message || 'No se pudo completar la acción.';\n          _this4.showToast('error', _this4.errorMessage);\n        } finally {\n          _this4.paying = false;\n          _this4.processingMessage = '';\n        }\n      })();\n    }\n    tryOpenEntregaAccordion() {\n      try {\n        const el = this.entregaAccordion?.nativeElement;\n        if (!el) return;\n        el.open = true;\n        el.scrollIntoView({\n          behavior: 'smooth',\n          block: 'start'\n        });\n      } catch {\n        // ignore\n      }\n    }\n    // Compat: slots antiguos ya no se usan en UI v2\n    seleccionarEntrega(_label) {\n      this.coordError = '';\n    }\n    seleccionarDevolucion(_label) {\n      this.coordError = '';\n    }\n    lugarValido(texto) {\n      const t = String(texto ?? '').trim();\n      if (!t) return false;\n      const low = t.toLowerCase();\n      if (low.includes('http://') || low.includes('https://') || low.includes('www.')) return false;\n      if (/\\d{7,}/.test(t)) return false; // evita teléfonos\n      return true;\n    }\n    recoordinar() {\n      const r = this.renta;\n      if (!r) return;\n      const id = r.id_renta ?? r.id;\n      this.clearCoordLocalV2(id);\n      this.clearFlowLocal(id);\n      this.lugarEntregaControl.setValue('', {\n        emitEvent: false\n      });\n      this.lugarDevolucionControl.setValue('', {\n        emitEvent: false\n      });\n      this.horaEntregaControl.setValue('', {\n        emitEvent: false\n      });\n      this.horaDevolucionControl.setValue('', {\n        emitEvent: false\n      });\n      this.coordError = '';\n      this.ensureCoordDraftTimer(id);\n      this.showToast('info', 'Puedes volver a coordinar.');\n    }\n    confirmarCoordinacionSimple() {\n      const r = this.renta;\n      if (!r) return;\n      if (!this.isPagada) {\n        this.coordError = 'Paga para habilitar coordinación.';\n        this.showToast('info', this.coordError);\n        return;\n      }\n      const id = r.id_renta ?? r.id;\n      this.ensureCoordDraftTimer(id);\n      if (this.coordExpiradaUi) {\n        this.coordError = 'Coordinación expirada. Vuelve a elegir lugar y hora.';\n        this.showToast('info', this.coordError);\n        return;\n      }\n      const entregaLugar = String(this.lugarEntregaControl.value ?? '').trim();\n      const devolucionLugar = String(this.lugarDevolucionControl.value ?? '').trim();\n      const entregaHora = String(this.horaEntregaControl.value ?? '').trim();\n      const devolucionHora = String(this.horaDevolucionControl.value ?? '').trim();\n      if (!this.lugarValido(entregaLugar) || !this.lugarValido(devolucionLugar)) {\n        this.coordError = 'Indica puntos de entrega/devolución (solo texto, sin links ni teléfonos).';\n        this.showToast('info', this.coordError);\n        return;\n      }\n      if (!entregaHora || !devolucionHora) {\n        this.coordError = 'Elige hora exacta para entrega y devolución.';\n        this.showToast('info', this.coordError);\n        return;\n      }\n      const confirmedAt = new Date().toISOString();\n      // Guardar coordinación completa en local (lugar+hora) y marcar etapa.\n      const existing = this.readCoordLocalV2(id);\n      this.writeCoordLocalV2(id, {\n        entregaLugar,\n        devolucionLugar,\n        entregaHora,\n        devolucionHora,\n        expiresAt: existing?.expiresAt,\n        confirmedAt\n      });\n      this.writeFlowLocal(id, {\n        estado: 'coordinacion_confirmada',\n        fecha_coordinacion_confirmada: confirmedAt\n      });\n      this.refrescar(id);\n      this.showToast('success', '✅ Coordinación confirmada.');\n      this.tryOpenEntregaAccordion();\n    }\n    get puedeConfirmarCoordinacionV2Ui() {\n      if (!this.renta) return false;\n      if (this.uiBloqueada) return false;\n      if (!this.isPagada) return false;\n      if (this.coordinacionConfirmadaUi) return false;\n      if (this.coordExpiradaUi) return false;\n      const entregaLugar = String(this.lugarEntregaControl.value ?? '').trim();\n      const devolucionLugar = String(this.lugarDevolucionControl.value ?? '').trim();\n      const entregaHora = String(this.horaEntregaControl.value ?? '').trim();\n      const devolucionHora = String(this.horaDevolucionControl.value ?? '').trim();\n      return this.lugarValido(entregaLugar) && this.lugarValido(devolucionLugar) && !!entregaHora && !!devolucionHora;\n    }\n    get puedeAbrirOtpEntregaUi() {\n      if (!this.renta) return false;\n      if (!this.soyArrendatario) return false;\n      if (this.uiBloqueada) return false;\n      if (!this.coordinacionConfirmadaUi) return false;\n      return !this.getFecha('fecha_en_uso');\n    }\n    get puedeAbrirOtpDevolucionUi() {\n      if (!this.renta) return false;\n      if (!this.soyArrendatario) return false;\n      if (this.uiBloqueada) return false;\n      return this.estadoFlujoNormalizado === 'en_uso';\n    }\n    abrirOtpEntrega() {\n      if (!this.puedeAbrirOtpEntregaUi) return;\n      this.otpArrError = '';\n      this.otpEntregaArrControl.setValue('', {\n        emitEvent: false\n      });\n      this.otpEntregaOpen = true;\n    }\n    cerrarOtpEntrega() {\n      this.otpEntregaOpen = false;\n      this.otpArrError = '';\n    }\n    abrirOtpDevolucion() {\n      if (!this.puedeAbrirOtpDevolucionUi) return;\n      this.otpArrError = '';\n      this.otpDevolucionArrControl.setValue('', {\n        emitEvent: false\n      });\n      this.otpDevolucionOpen = true;\n    }\n    cerrarOtpDevolucion() {\n      this.otpDevolucionOpen = false;\n      this.otpArrError = '';\n    }\n    confirmarOtpEntregaArr() {\n      const r = this.renta;\n      if (!r) return;\n      const id = r.id_renta ?? r.id;\n      const entered = String(this.otpEntregaArrControl.value ?? '').replace(/\\D+/g, '').slice(0, 6);\n      const expected = String(r.codigo_entrega ?? '').trim();\n      if (entered.length !== 6) {\n        this.otpArrError = 'Ingresa el OTP de entrega (6 dígitos).';\n        return;\n      }\n      if (!expected) {\n        this.otpArrError = 'No hay OTP de entrega disponible.';\n        return;\n      }\n      if (entered !== expected) {\n        this.otpArrError = 'OTP incorrecto.';\n        return;\n      }\n      const now = new Date().toISOString();\n      this.writeFlowLocal(id, {\n        estado: 'en_uso',\n        fecha_entrega_confirmada: now,\n        fecha_en_uso: now\n      });\n      this.otpEntregaOpen = false;\n      this.refrescar(id);\n      this.showToast('success', '✅ Entrega confirmada. Renta en uso.');\n    }\n    confirmarOtpDevolucionArr() {\n      const r = this.renta;\n      if (!r) return;\n      const id = r.id_renta ?? r.id;\n      const entered = String(this.otpDevolucionArrControl.value ?? '').replace(/\\D+/g, '').slice(0, 6);\n      const expected = String(r.codigo_devolucion ?? '').trim();\n      if (entered.length !== 6) {\n        this.otpArrError = 'Ingresa el OTP de devolución (6 dígitos).';\n        return;\n      }\n      if (!expected) {\n        this.otpArrError = 'No hay OTP de devolución disponible.';\n        return;\n      }\n      if (entered !== expected) {\n        this.otpArrError = 'OTP incorrecto.';\n        return;\n      }\n      const now = new Date().toISOString();\n      this.writeFlowLocal(id, {\n        estado: 'devuelta',\n        fecha_devolucion: now\n      });\n      this.otpDevolucionOpen = false;\n      this.refrescar(id);\n      this.showToast('success', '✅ Devolución confirmada.');\n    }\n    sincronizarFormulariosConRenta() {\n      const r = this.renta;\n      if (!r) return;\n      const id = r.id_renta ?? r.id;\n      const v2 = this.readCoordLocalV2(id);\n      if (v2) {\n        this.lugarEntregaControl.setValue(v2.entregaLugar, {\n          emitEvent: false\n        });\n        this.lugarDevolucionControl.setValue(v2.devolucionLugar, {\n          emitEvent: false\n        });\n        this.horaEntregaControl.setValue(v2.entregaHora, {\n          emitEvent: false\n        });\n        this.horaDevolucionControl.setValue(v2.devolucionHora, {\n          emitEvent: false\n        });\n      }\n      // Dueño: precargar valores\n      this.modoEntregaControl.setValue((r.modo_entrega || 'arrendador') === 'neutral' ? 'neutral' : 'arrendador', {\n        emitEvent: false\n      });\n      this.entregaModoControl.setValue((r.entrega_modo || 'domicilio') === 'punto_entrega' ? 'punto_entrega' : 'domicilio', {\n        emitEvent: false\n      });\n      this.puntoEntregaIdControl.setValue(r.punto_entrega?.id != null ? String(r.punto_entrega.id) : '', {\n        emitEvent: false\n      });\n      this.zonaPublicaControl.setValue(r.zona_publica ?? '', {\n        emitEvent: false\n      });\n      this.direccionEntregaControl.setValue(r.direccion_entrega ?? '', {\n        emitEvent: false\n      });\n      const ve = (r.ventanas_entrega_propuestas ?? []).join('\\n');\n      const vd = (r.ventanas_devolucion_propuestas ?? []).join('\\n');\n      this.ventanasEntregaControl.setValue(ve, {\n        emitEvent: false\n      });\n      this.ventanasDevolucionControl.setValue(vd, {\n        emitEvent: false\n      });\n      // Arrendatario: precargar selección\n      this.ventanaEntregaElegidaControl.setValue(r.ventana_entrega_elegida ?? '', {\n        emitEvent: false\n      });\n      this.ventanaDevolucionElegidaControl.setValue(r.ventana_devolucion_elegida ?? '', {\n        emitEvent: false\n      });\n      // Si aplica, cargar el catálogo de puntos seguros.\n      if (this.soyDueno && (r.entrega_modo || 'domicilio') === 'punto_entrega') {\n        this.cargarPuntosEntregaSiHaceFalta();\n      }\n    }\n    cargarPuntosEntregaSiHaceFalta() {\n      if (this.puntosEntregaLoading) return;\n      if ((this.puntosEntrega?.length ?? 0) > 0) return;\n      this.puntosEntregaError = '';\n      this.puntosEntregaLoading = true;\n      this.puntoEntregaService.listarActivos().subscribe({\n        next: items => {\n          this.puntosEntrega = items ?? [];\n          this.puntosEntregaLoading = false;\n        },\n        error: err => {\n          this.puntosEntregaLoading = false;\n          this.puntosEntregaError = err?.error?.message || 'No se pudieron cargar los puntos seguros.';\n          this.showToast('info', this.puntosEntregaError);\n        }\n      });\n    }\n    iniciarChatPollingSiCorresponde(idRenta) {\n      if (!this.renta || this.renta.chat_habilitado !== true || this.uiBloqueada) {\n        this.detenerChatPolling();\n        return;\n      }\n      if (this.chatSub) return;\n      this.chatSub = interval(7000).pipe(startWith(0), switchMap(() => this.rentaService.getChat(idRenta))).subscribe({\n        next: items => {\n          this.chatMessages = items || [];\n          this.scrollChatAbajo();\n        },\n        error: () => {\n          // silencioso: no rompe UX\n        }\n      });\n    }\n    scrollASiCorresponde() {\n      if (!this.shouldFocusChat) return;\n      if (!this.renta || this.renta.chat_habilitado !== true) return;\n      setTimeout(() => {\n        try {\n          document.getElementById('chat')?.scrollIntoView({\n            behavior: 'smooth',\n            block: 'start'\n          });\n        } catch {\n          // ignore\n        }\n      }, 0);\n    }\n    marcarChatLeidoSiCorresponde(idRenta) {\n      if (!this.renta || this.renta.chat_habilitado !== true) return;\n      this.rentaService.chatMarcarLeido(idRenta).subscribe({\n        next: () => {\n          // no-op\n        },\n        error: () => {\n          // silencioso\n        }\n      });\n    }\n    detenerChatPolling() {\n      if (this.chatSub) {\n        this.chatSub.unsubscribe();\n        this.chatSub = null;\n      }\n    }\n    scrollChatAbajo() {\n      if (!this.chatScroll?.nativeElement) return;\n      setTimeout(() => {\n        try {\n          const el = this.chatScroll?.nativeElement;\n          if (!el) return;\n          el.scrollTop = el.scrollHeight;\n        } catch {\n          // ignore\n        }\n      }, 0);\n    }\n    guardarCoordinacion() {\n      if (!this.renta) return;\n      if (!this.soyDueno) return;\n      if (this.uiBloqueada) return;\n      const id = this.renta.id_renta ?? this.renta.id;\n      const modo = this.modoEntregaControl.value || 'arrendador';\n      const entrega_modo = this.entregaModoControl.value || 'domicilio';\n      let id_punto_entrega = null;\n      let zona_publica = (this.zonaPublicaControl.value ?? '').toString().trim() || null;\n      let direccion_entrega = (this.direccionEntregaControl.value ?? '').toString().trim() || null;\n      if (entrega_modo === 'punto_entrega') {\n        const raw = (this.puntoEntregaIdControl.value ?? '').toString().trim();\n        const parsed = raw ? Number(raw) : NaN;\n        if (!Number.isFinite(parsed) || parsed <= 0) {\n          this.showToast('error', 'Elige un punto seguro.');\n          return;\n        }\n        id_punto_entrega = parsed;\n        zona_publica = null;\n        direccion_entrega = null;\n      }\n      const ventanasEntrega = (this.ventanasEntregaControl.value ?? '').toString().split('\\n').map(s => s.trim()).filter(Boolean);\n      const ventanasDevolucion = (this.ventanasDevolucionControl.value ?? '').toString().split('\\n').map(s => s.trim()).filter(Boolean);\n      this.ejecutarAccion('Guardando coordinación...', () => this.rentaService.coordinar(id, {\n        modo_entrega: modo,\n        entrega_modo,\n        id_punto_entrega,\n        zona_publica,\n        direccion_entrega,\n        ventanas_entrega_propuestas: ventanasEntrega.length ? ventanasEntrega : null,\n        ventanas_devolucion_propuestas: ventanasDevolucion.length ? ventanasDevolucion : null\n      }), id, 'Coordinación actualizada.');\n    }\n    confirmarCoordinacion() {\n      if (!this.renta) return;\n      if (!this.puedeConfirmarCoordinacion) return;\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.ejecutarAccion('Confirmando coordinación...', () => this.rentaService.coordinar(id, {\n        confirmar: true\n      }), id, 'Coordinación confirmada.');\n    }\n    aceptarCoordinacion() {\n      if (!this.renta) return;\n      if (!this.soyArrendatario) return;\n      if (this.uiBloqueada) return;\n      const ve = (this.ventanaEntregaElegidaControl.value ?? '').toString().trim();\n      const vd = (this.ventanaDevolucionElegidaControl.value ?? '').toString().trim();\n      if (!ve || !vd) {\n        this.showToast('error', 'Elige ventana de entrega y devolución.');\n        return;\n      }\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.ejecutarAccion('Aceptando coordinación...', () => this.rentaService.aceptarCoordinacion(id, {\n        ventana_entrega: ve,\n        ventana_devolucion: vd\n      }), id, 'Coordinación aceptada.');\n    }\n    enviarChat() {\n      if (!this.renta) return;\n      if (!this.puedeEnviarChat) return;\n      const msg = (this.chatInputControl.value ?? '').toString().trim();\n      if (!msg) {\n        this.showToast('error', 'Escribe un mensaje.');\n        return;\n      }\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.paying = true;\n      this.processingMessage = 'Enviando mensaje...';\n      this.rentaService.sendChatMessage(id, msg).subscribe({\n        next: () => {\n          this.paying = false;\n          this.processingMessage = '';\n          this.chatInputControl.reset('');\n          // Refrescar chat una vez\n          this.rentaService.getChat(id).subscribe({\n            next: items => {\n              this.chatMessages = items || [];\n              this.scrollChatAbajo();\n            },\n            error: () => {\n              // ignore\n            }\n          });\n        },\n        error: err => {\n          this.paying = false;\n          this.processingMessage = '';\n          const status = err?.status;\n          if (status === 429) {\n            const m = err?.error?.message || 'Estás enviando muy rápido. Intenta de nuevo en unos segundos.';\n            this.showToast('error', m);\n            return;\n          }\n          const m = err?.error?.message || 'No se pudo enviar el mensaje.';\n          this.showToast('error', m);\n        }\n      });\n    }\n    confirmarEntregaOtp() {\n      if (!this.renta) return;\n      if (!this.puedeConfirmarEntregaOtp) return;\n      const codigo = (this.otpEntregaControl.value ?? '').toString().trim();\n      const checklist = (this.checklistEntregaControl.value ?? '').toString().trim() || null;\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.ejecutarAccion('Confirmando entrega (OTP)...', () => this.rentaService.confirmarEntregaOtp(id, {\n        codigo,\n        checklist\n      }), id, 'Entrega confirmada (OTP).');\n      this.otpEntregaControl.reset('');\n    }\n    confirmarDevolucionOtp() {\n      if (!this.renta) return;\n      if (!this.puedeConfirmarDevolucionOtp) return;\n      const codigo = (this.otpDevolucionControl.value ?? '').toString().trim();\n      const checklist = (this.checklistDevolucionControl.value ?? '').toString().trim() || null;\n      const id = this.renta.id_renta ?? this.renta.id;\n      this.ejecutarAccion('Confirmando devolución (OTP)...', () => this.rentaService.confirmarDevolucionOtp(id, {\n        codigo,\n        checklist\n      }), id, 'Devolución confirmada (OTP).');\n      this.otpDevolucionControl.reset('');\n    }\n    cargarMiCalificacion(idRenta) {\n      this.rentaService.obtenerCalificacion(idRenta).subscribe({\n        next: data => {\n          this.ratingSupported = true;\n          this.miCalificacion = data?.calificacion ?? null;\n          this.showCalificar = false;\n        },\n        error: () => {\n          // si falla, oculta el panel\n          this.ratingSupported = false;\n          this.miCalificacion = null;\n          this.showCalificar = false;\n        }\n      });\n    }\n    ejecutarAccion(processingMsg, action, idRenta, successMsg) {\n      this.errorMessage = '';\n      this.successMessage = '';\n      this.paying = true;\n      this.processingMessage = processingMsg;\n      action().subscribe({\n        next: () => {\n          this.paying = false;\n          this.processingMessage = '';\n          this.successMessage = successMsg;\n          this.showToast('success', successMsg);\n          this.refrescar(idRenta);\n        },\n        error: err => {\n          this.paying = false;\n          this.processingMessage = '';\n          const status = err?.status;\n          const hasToken = !!this.authService.getToken();\n          if ((status === 401 || status === 422) && !hasToken) {\n            this.router.navigate(['/login']);\n            return;\n          }\n          this.errorMessage = err?.error?.message || 'No se pudo completar la acción.';\n          this.showToast('error', this.errorMessage);\n        }\n      });\n    }\n    showToast(type, message) {\n      this.toastType = type;\n      this.toastMessage = message;\n      if (this.toastTimer) {\n        clearTimeout(this.toastTimer);\n        this.toastTimer = null;\n      }\n      this.toastTimer = setTimeout(() => {\n        this.toastMessage = '';\n        this.toastTimer = null;\n      }, 3500);\n    }\n    static {\n      this.ɵfac = function RentaResumenComponent_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || RentaResumenComponent)(i0.ɵɵdirectiveInject(i1.ActivatedRoute), i0.ɵɵdirectiveInject(i1.Router), i0.ɵɵdirectiveInject(i2.RentaService), i0.ɵɵdirectiveInject(i3.AuthService), i0.ɵɵdirectiveInject(i4.BadgeService), i0.ɵɵdirectiveInject(i5.PuntoEntregaService));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: RentaResumenComponent,\n        selectors: [[\"app-renta-resumen\"]],\n        viewQuery: function RentaResumenComponent_Query(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵviewQuery(_c0, 5);\n            i0.ɵɵviewQuery(_c1, 5);\n          }\n          if (rf & 2) {\n            let _t;\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.entregaAccordion = _t.first);\n            i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.chatScroll = _t.first);\n          }\n        },\n        decls: 14,\n        vars: 6,\n        consts: [[\"entregaAccordion\", \"\"], [\"chatScroll\", \"\"], [1, \"page-wrapper\"], [1, \"card\"], [1, \"card-header\"], [\"type\", \"button\", 1, \"btn-secondary\", 3, \"click\"], [1, \"spacer\"], [\"class\", \"state-message\", 4, \"ngIf\"], [\"class\", \"state-message error\", 4, \"ngIf\"], [\"class\", \"toast\", 3, \"toast-success\", \"toast-error\", 4, \"ngIf\"], [4, \"ngIf\"], [1, \"state-message\"], [1, \"state-message\", \"error\"], [\"aria-hidden\", \"true\", 1, \"spinner\"], [1, \"toast\"], [1, \"resumen\", \"resumen-compacto\"], [1, \"titulo\"], [1, \"badge\"], [1, \"meta\", \"meta-2\"], [1, \"totales\", \"totales-compacto\"], [1, \"sub\"], [1, \"actions\", \"primary-actions\"], [\"class\", \"btn-primary\", \"type\", \"button\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [\"type\", \"button\", 1, \"btn-secondary\", 3, \"click\", \"disabled\"], [1, \"accordion\"], [1, \"accordion-body\"], [1, \"mini-steps\"], [3, \"done\", 4, \"ngFor\", \"ngForOf\"], [\"class\", \"incidente\", \"id\", \"chat\", 4, \"ngIf\"], [\"class\", \"incidente\", 4, \"ngIf\"], [\"class\", \"accordion\", 4, \"ngIf\"], [1, \"actions\"], [\"class\", \"btn-secondary\", \"type\", \"button\", 3, \"disabled\", \"click\", 4, \"ngIf\"], [\"class\", \"pay-backdrop\", 3, \"click\", 4, \"ngIf\"], [\"class\", \"pay-modal\", \"role\", \"dialog\", \"aria-modal\", \"true\", 4, \"ngIf\"], [\"type\", \"button\", 1, \"btn-primary\", 3, \"click\", \"disabled\"], [1, \"status\"], [\"class\", \"coord\", 4, \"ngIf\"], [1, \"coord\"], [1, \"coord-group\"], [1, \"coord-label\"], [1, \"slot-buttons\"], [\"type\", \"button\", \"class\", \"btn-slot\", 3, \"active\", \"disabled\", \"click\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"button\", 1, \"btn-slot\", 3, \"click\", \"disabled\"], [\"id\", \"chat\", 1, \"incidente\"], [1, \"timeline-title\"], [2, \"max-height\", \"220px\", \"overflow\", \"auto\", \"padding\", \"8px\"], [\"class\", \"state-message\", 3, \"error\", 4, \"ngFor\", \"ngForOf\"], [\"type\", \"text\", \"placeholder\", \"Escribe un mensaje...\", 3, \"formControl\", \"disabled\"], [1, \"incidente\"], [\"type\", \"text\", \"placeholder\", \"6 d\\u00EDgitos\", 3, \"formControl\"], [\"rows\", \"2\", \"placeholder\", \"Estado, accesorios, notas...\", 3, \"formControl\"], [1, \"timeline\"], [\"class\", \"timeline-item\", 3, \"done\", \"alert\", 4, \"ngFor\", \"ngForOf\"], [1, \"timeline-item\"], [1, \"dot\"], [1, \"line\"], [1, \"content\"], [1, \"label\"], [\"class\", \"date\", 4, \"ngIf\"], [1, \"date\"], [\"class\", \"spinner\", \"aria-hidden\", \"true\", 4, \"ngIf\"], [\"rows\", \"3\", \"placeholder\", \"Motivo...\", 3, \"formControl\"], [\"rows\", \"3\", \"placeholder\", \"\\u00BFQu\\u00E9 ocurri\\u00F3?\", 3, \"formControl\"], [\"type\", \"radio\", \"value\", \"liberar\", 3, \"formControl\"], [\"type\", \"radio\", \"value\", \"retener_parcial\", 3, \"formControl\"], [\"type\", \"radio\", \"value\", \"retener_total\", 3, \"formControl\"], [\"style\", \"margin-top: 8px;\", 4, \"ngIf\"], [2, \"margin-top\", \"8px\"], [\"rows\", \"2\", \"placeholder\", \"Detalle de la decisi\\u00F3n\", 3, \"formControl\"], [\"class\", \"hint\", 4, \"ngIf\"], [\"type\", \"number\", \"placeholder\", \"0\", 3, \"formControl\"], [1, \"hint\"], [\"role\", \"group\", \"aria-label\", \"Calificaci\\u00F3n\", 1, \"stars\"], [\"type\", \"button\", 1, \"star\", 3, \"click\"], [\"rows\", \"2\", \"placeholder\", \"Comentario (opcional)\", 3, \"formControl\"], [1, \"pay-backdrop\", 3, \"click\"], [\"role\", \"dialog\", \"aria-modal\", \"true\", 1, \"pay-modal\"], [1, \"pay-card\", 3, \"click\"], [1, \"pay-head\"], [1, \"pay-form\", 3, \"ngSubmit\"], [\"type\", \"text\", \"inputmode\", \"numeric\", \"pattern\", \"[0-9]*\", \"autocomplete\", \"cc-number\", \"placeholder\", \"1234 5678 1234 5678\", \"maxlength\", \"19\", 3, \"input\", \"value\"], [1, \"pay-grid\"], [\"type\", \"text\", \"inputmode\", \"numeric\", \"pattern\", \"[0-9]*\", \"autocomplete\", \"cc-exp\", \"placeholder\", \"MM/YY\", \"maxlength\", \"5\", 3, \"input\", \"value\"], [\"type\", \"password\", \"inputmode\", \"numeric\", \"pattern\", \"[0-9]*\", \"autocomplete\", \"cc-csc\", \"placeholder\", \"123\", \"maxlength\", \"3\", 3, \"input\", \"value\"], [\"type\", \"submit\", 1, \"btn-primary\", 3, \"click\", \"disabled\"]],\n        template: function RentaResumenComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 2)(1, \"section\", 3)(2, \"div\", 4)(3, \"button\", 5);\n            i0.ɵɵlistener(\"click\", function RentaResumenComponent_Template_button_click_3_listener() {\n              return ctx.volverExplorar();\n            });\n            i0.ɵɵtext(4, \"Volver a explorar\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(5, \"h2\");\n            i0.ɵɵtext(6, \"Resumen de renta\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(7, \"div\", 6);\n            i0.ɵɵelementEnd();\n            i0.ɵɵtemplate(8, RentaResumenComponent_div_8_Template, 2, 0, \"div\", 7)(9, RentaResumenComponent_div_9_Template, 2, 1, \"div\", 8)(10, RentaResumenComponent_div_10_Template, 2, 1, \"div\", 7)(11, RentaResumenComponent_div_11_Template, 3, 1, \"div\", 7)(12, RentaResumenComponent_div_12_Template, 2, 5, \"div\", 9)(13, RentaResumenComponent_ng_container_13_Template, 74, 41, \"ng-container\", 10);\n            i0.ɵɵelementEnd()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(8);\n            i0.ɵɵproperty(\"ngIf\", ctx.loading);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.errorMessage);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.successMessage);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading && ctx.paying);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", ctx.toastMessage);\n            i0.ɵɵadvance();\n            i0.ɵɵproperty(\"ngIf\", !ctx.loading && !ctx.errorMessage && ctx.renta);\n          }\n        },\n        dependencies: [i6.NgForOf, i6.NgIf, i7.ɵNgNoValidate, i7.DefaultValueAccessor, i7.NumberValueAccessor, i7.RadioControlValueAccessor, i7.NgControlStatus, i7.NgControlStatusGroup, i7.FormControlDirective, i6.DatePipe],\n        styles: [\"@charset \\\"UTF-8\\\";.resumen[_ngcontent-%COMP%]{display:grid;gap:12px;padding:12px;border:1px solid var(--border);border-radius:var(--radius-md);background:var(--surface-2);margin-bottom:12px}.resumen-compacto[_ngcontent-%COMP%]{gap:10px}.titulo[_ngcontent-%COMP%]{font-size:18px;font-weight:700;display:flex;align-items:center;gap:10px;flex-wrap:wrap}.meta[_ngcontent-%COMP%]{display:grid;gap:6px}.meta-2[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr;gap:10px}.totales[_ngcontent-%COMP%]{display:grid;gap:6px}.totales-compacto[_ngcontent-%COMP%]{grid-template-columns:1fr}.sub[_ngcontent-%COMP%]{opacity:.9;font-size:14px}.actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}.primary-actions[_ngcontent-%COMP%]{margin-top:0;margin-bottom:12px}.accordion[_ngcontent-%COMP%]{border:1px solid var(--border);border-radius:var(--radius-md);background:var(--surface-2);padding:0;margin-top:12px}.accordion[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]{cursor:pointer;list-style:none;padding:12px;font-weight:800;color:var(--text)}.accordion[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]::-webkit-details-marker{display:none}.accordion[_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]:after{content:\\\"\\\\25be\\\";float:right;opacity:.7}.accordion[open][_ngcontent-%COMP%] > summary[_ngcontent-%COMP%]:after{content:\\\"\\\\25b4\\\"}.accordion-body[_ngcontent-%COMP%]{padding:0 12px 12px}.pay-backdrop[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0206178c;z-index:1100}.pay-modal[_ngcontent-%COMP%]{position:fixed;inset:0;display:grid;place-items:center;padding:16px;z-index:1101}.pay-card[_ngcontent-%COMP%]{width:min(520px,100vw - 32px);border:1px solid var(--border);border-radius:16px;background:var(--surface-1);box-shadow:var(--shadow-2);padding:14px}.pay-head[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:10px}.pay-head[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:16px}.pay-form[_ngcontent-%COMP%]{display:grid;gap:10px;margin-top:10px}.pay-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;gap:10px}@media (max-width: 600px){.meta-2[_ngcontent-%COMP%], .pay-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}}.incidente[_ngcontent-%COMP%]{margin-top:12px;display:grid;gap:8px;padding:12px;border:1px solid var(--border);border-radius:var(--radius-md);background:var(--surface-2)}.incidente[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;resize:vertical}.timeline[_ngcontent-%COMP%]{margin-top:12px;padding:12px;border:1px solid var(--border);border-radius:var(--radius-md);background:var(--surface-2)}.timeline-title[_ngcontent-%COMP%]{font-weight:700;margin-bottom:8px}.timeline-item[_ngcontent-%COMP%]{display:grid;grid-template-columns:14px 1fr;column-gap:10px;position:relative;padding:6px 0;opacity:.75}.timeline-item.done[_ngcontent-%COMP%], .timeline-item.alert[_ngcontent-%COMP%]{opacity:1}.dot[_ngcontent-%COMP%]{width:10px;height:10px;margin-top:3px;border-radius:50%;border:2px solid var(--border-strong)}.timeline-item.done[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{border-color:#14b8a6bf}.timeline-item.alert[_ngcontent-%COMP%]   .dot[_ngcontent-%COMP%]{border-color:#ef4444bf}.line[_ngcontent-%COMP%]{position:absolute;left:5px;top:18px;bottom:-6px;width:2px;background:var(--border)}.timeline-item[_ngcontent-%COMP%]:last-child   .line[_ngcontent-%COMP%]{display:none}.label[_ngcontent-%COMP%]{font-weight:600}.date[_ngcontent-%COMP%]{font-size:12px;opacity:.85}.stars[_ngcontent-%COMP%]{display:inline-flex;gap:6px}.star[_ngcontent-%COMP%]{border:1px solid var(--border);background:var(--surface-2);border-radius:var(--radius-sm);width:34px;height:34px;font-size:18px;line-height:1}.star.active[_ngcontent-%COMP%]{border-color:#14b8a666;background:#14b8a61f}.mini-steps[_ngcontent-%COMP%]{margin:10px 0 12px;padding:0;list-style:none;display:grid;gap:6px}.mini-steps[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px;border:1px solid var(--border);border-radius:var(--radius-md);background:var(--surface-1);opacity:.8}.mini-steps[_ngcontent-%COMP%]   li.done[_ngcontent-%COMP%]{opacity:1;border-color:#14b8a659;background:#14b8a614}.mini-steps[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]{font-weight:700}.coord[_ngcontent-%COMP%]{display:grid;gap:12px}.coord-group[_ngcontent-%COMP%]{display:grid;gap:8px}.coord-label[_ngcontent-%COMP%]{font-weight:700}.slot-buttons[_ngcontent-%COMP%]{display:flex;gap:8px;flex-wrap:wrap}.btn-slot[_ngcontent-%COMP%]{border:1px solid var(--border);background:var(--surface-1);border-radius:999px;padding:8px 12px;font-weight:700}.btn-slot.active[_ngcontent-%COMP%]{border-color:#14b8a68c;background:#14b8a624}\"]\n      });\n    }\n  }\n  return RentaResumenComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}